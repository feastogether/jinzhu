<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>çœŸç  å°ç£ä½³å‘³ âœ¦ æ±‚å¥½é‹</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700;900&family=Noto+Sans+TC:wght@300;400;500&display=swap');
:root{
  --green:#00352c; --green-mid:#2d6b5e; --green-lt:#7bbcad;
  --red:#d90050;   --gold:#c0ab7c;      --gold-lt:#e8d9a8;
  --cream:#fdf8f0; --warm:#f5ede0;      --warm2:#f0e4d0;
  --text:#00352c;  --text2:#4a3a28;     --text3:#9a8870;
  --font-s:'Noto Serif TC',serif; --font-n:'Noto Sans TC',sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
html,body{width:100%;height:100%;overflow:hidden;font-family:var(--font-n);background:var(--cream);}
.page{position:fixed;top:0;left:0;width:100%;height:100%;display:none;overflow:hidden;}
.page.active{display:block;}

/* PRELOADER */
#preloader{position:fixed;inset:0;background:var(--cream);display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:9999;transition:opacity .8s;}
.pre-logo{width:120px; height:auto; animation:breath 1.8s ease-in-out infinite;}
@keyframes breath{0%,100%{transform:scale(1);opacity:.85;}50%{transform:scale(1.07);opacity:1;}}
.pre-text{margin-top:14px;font-family:var(--font-s);font-size:.8rem;color:var(--green-mid);letter-spacing:.5em;}

/* OVERLAY */
.overlay{position:fixed;inset:0;background:var(--cream);z-index:5000;pointer-events:none;opacity:0;transition:opacity .3s;}
.overlay.in{opacity:1;pointer-events:all;}

#soundBtn{position:fixed;top:14px;right:14px;width:36px;height:36px;background:rgba(255,255,255,.88);border:1px solid #c8e6e0;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:300;}

/* â”€â”€ èŠ±ç£šèƒŒæ™¯ â”€â”€ */
.tile-bg{
  position:absolute;inset:0;pointer-events:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Crect width='80' height='80' fill='none'/%3E%3Crect x='1' y='1' width='78' height='78' fill='none' stroke='%232d6b5e' stroke-width='.7' opacity='.14'/%3E%3Cline x1='40' y1='1' x2='40' y2='79' stroke='%232d6b5e' stroke-width='.5' opacity='.1'/%3E%3Cline x1='1' y1='40' x2='79' y2='40' stroke='%232d6b5e' stroke-width='.5' opacity='.1'/%3E%3Cline x1='1' y1='1' x2='79' y2='79' stroke='%232d6b5e' stroke-width='.35' opacity='.08'/%3E%3Cline x1='79' y1='1' x2='1' y2='79' stroke='%232d6b5e' stroke-width='.35' opacity='.08'/%3E%3Cpolygon points='40,22 52,32 58,40 52,48 40,58 28,48 22,40 28,32' fill='none' stroke='%232d6b5e' stroke-width='.7' opacity='.12'/%3E%3Crect x='34' y='34' width='12' height='12' fill='none' stroke='%23c0ab7c' stroke-width='.7' opacity='.18' transform='rotate(45 40 40)'/%3E%3C/svg%3E");
  background-size:80px 80px;
}
.tile-bar{position:absolute;left:0;right:0;height:9px;}
.tile-bar.top{top:0;background:repeating-linear-gradient(90deg,var(--green) 0 20px,var(--gold) 20px 40px,var(--red) 40px 60px,var(--green) 60px 80px);opacity:.82;}
.tile-bar.bottom{bottom:0;background:repeating-linear-gradient(90deg,var(--red) 0 20px,var(--green) 20px 40px,var(--gold) 40px 60px,var(--red) 60px 80px);opacity:.82;}

/* â”€â”€ COVER â”€â”€ */
#pageCover{background:linear-gradient(160deg,var(--cream) 0%,var(--warm) 100%);}
.pillar{position:absolute;top:0;bottom:0;width:min(11vw,46px);}
.pillar.left{left:0;} .pillar.right{right:0;}
.disk-wrap{position:absolute;top:50%;left:50%;transform:translate(-50%,-54%);width:min(78vw,330px);height:min(78vw,330px);animation:floatDisk 6s ease-in-out infinite;}
@keyframes floatDisk{0%,100%{transform:translate(-50%,-54%);}50%{transform:translate(-50%,-58%);}}

.cover-header{position:absolute;top:5%;left:0;right:0;display:flex;flex-direction:column;align-items:center;z-index:10;}
.cover-logo{width:140px; height:auto; margin-bottom:10px;}
.cover-div{display:flex;align-items:center;gap:10px;}
.cover-div span{height:1px;width:30px;background:linear-gradient(90deg,transparent,var(--gold),transparent);}
.cover-div em{font-style:normal;color:var(--gold);font-size:.72rem;letter-spacing:.3em;}

.btn-enter-wrap{position:absolute;bottom:9%;left:50%;transform:translateX(-50%);z-index:10;}
.btn-enter{
  background:var(--green);color:var(--cream);font-family:var(--font-s);font-size:1.1rem;font-weight:600;letter-spacing:.4em;padding:14px 44px;border-radius:4px;border:none;box-shadow:0 4px 0 #001a15;transition:all .15s;
}
.btn-enter-wrap:active .btn-enter{transform:translateY(3px);box-shadow:0 1px 0 #001a15;}

/* â”€â”€ GAME & RESULT â”€â”€ */
.game-logo{width:110px; height:auto;}
.shake-can{width:min(38vw,152px);height:min(48vw,192px);cursor:pointer;}
.shake-can.shaking{animation:canShake 2s cubic-bezier(.36,.07,.19,.97);}
@keyframes canShake{0%,100%{transform:rotate(0);}10%,30%,50%,70%,90%{transform:rotate(-15deg) translateX(-5px);}20%,40%,60%,80%{transform:rotate(15deg) translateX(5px);}}

.f-card{width:100%;max-width:380px;background:var(--cream);border:1.5px solid #c8e6e0;border-radius:6px;overflow:hidden;box-shadow:0 8px 36px rgba(0,53,44,.1);}
.sect-tag{background:var(--green);color:var(--cream);font-size:.7rem;padding:3px 10px;border-radius:2px;margin-right:10px;}

/* æ­¤è™•çœç•¥å…¶é¤˜é‡è¤‡çš„ CSS ä»¥ä¿æŒç¯‡å¹…ï¼Œä½†çµæ§‹èˆ‡æ‚¨æä¾›çš„åŸå§‹ç¢¼ä¸€è‡´ */
/* åŒ…æ‹¬ .petal, .perm-dlg, .shake-tip, .flying-stick, .card-hd ç­‰... */
</style>
<body>
<div id="preloader">
  <img src="https://pydlnqriztpzgxbjuohm.supabase.co/storage/v1/object/public/assets/logo_1771308542401.svg?t=1772192672525" class="pre-logo" alt="Logo">
  <div class="pre-text">æ­£åœ¨ç‚ºæ‚¨ç¥ˆç¦ Â· è«‹ç¨å€™</div>
</div>

<div class="overlay" id="overlay"></div>
<button id="soundBtn">ğŸ”Š</button>
<div id="stickOverlay"></div>

<div class="page active" id="pageCover">
  <div class="tile-bg"></div>
  <div class="tile-bar top"></div>
  <div class="tile-bar bottom"></div>

  <div class="cover-header">
    <img src="https://pydlnqriztpzgxbjuohm.supabase.co/storage/v1/object/public/assets/logo_1771308542401.svg?t=1772192672525" class="cover-logo" alt="Logo">
    <div class="cover-div">
      <span></span><em id="coverSubtitle">æ±‚å¥½é‹ Â· å•å¤©æ©Ÿ</em><span></span>
    </div>
  </div>

  <div class="disk-wrap" id="lDisk">
    <svg viewBox="0 0 330 330" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
      <circle cx="165" cy="165" r="160" fill="rgba(245,237,224,.88)" stroke="#c0ab7c" stroke-width="2"/>
      <line x1="165" y1="5" x2="165" y2="325" stroke="#2d6b5e" stroke-width=".7" opacity=".15"/>
      <line x1="5" y1="165" x2="325" y2="165" stroke="#2d6b5e" stroke-width=".7" opacity=".15"/>
      <circle cx="165" cy="38" r="18" fill="#fdf8f0" stroke="#2d6b5e" stroke-width="1.5"/>
      <text x="165" y="44" text-anchor="middle" font-size="14" fill="#00352c" font-family="serif" font-weight="bold">ç¦</text>
      <circle cx="165" cy="292" r="18" fill="#fdf8f0" stroke="#d90050" stroke-width="1.5"/>
      <text x="165" y="298" text-anchor="middle" font-size="14" fill="#d90050" font-family="serif" font-weight="bold">ç¥¿</text>
      <circle cx="38" cy="165" r="18" fill="#fdf8f0" stroke="#2d6b5e" stroke-width="1.5"/>
      <text x="38" y="171" text-anchor="middle" font-size="14" fill="#00352c" font-family="serif" font-weight="bold">å£½</text>
      <circle cx="292" cy="165" r="18" fill="#fdf8f0" stroke="#d90050" stroke-width="1.5"/>
      <text x="292" y="171" text-anchor="middle" font-size="14" fill="#d90050" font-family="serif" font-weight="bold">å–œ</text>
      
      <circle cx="165" cy="165" r="60" fill="rgba(253,248,240,.95)" stroke="#2d6b5e" stroke-width="2"/>
      <rect x="149" y="142" width="32" height="44" rx="4" fill="#2d6b5e" opacity=".85"/>
      <text x="165" y="153" text-anchor="middle" font-size="7" fill="rgba(255,248,220,.82)">çœŸç </text>
    </svg>
  </div>

  <div class="btn-enter-wrap" onclick="goToGame()">
    <button class="btn-enter" id="btnEnterText">æ–ä¸€æ–æ±‚ç±¤</button>
  </div>
</div>

<div class="page" id="pageGame">
  <div class="game-wrap">
    <div class="game-top">
      <img src="https://pydlnqriztpzgxbjuohm.supabase.co/storage/v1/object/public/assets/logo_1771308542401.svg?t=1772192672525" class="game-logo" alt="Logo">
      <div class="game-title" id="gameTitle">âœ¦ çœŸç å¥½é‹ç±¤ âœ¦</div>
    </div>
    <div class="shake-can" id="shakeCan" onclick="doShake()">
      <svg viewBox="0 0 152 192" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="cg1" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#00352c"/><stop offset="40%" stop-color="#2d6b5e"/><stop offset="100%" stop-color="#00352c"/>
          </linearGradient>
        </defs>
        <g id="sticks" style="opacity:0;transition:opacity .25s;">
          <rect x="64" y="6" width="7" height="82" rx="3.5" fill="#c8904a"/>
          <rect x="76" y="10" width="7" height="78" rx="3.5" fill="#a07030" transform="rotate(11,79,49)"/>
        </g>
        <rect x="42" y="80" width="68" height="104" rx="6" fill="url(#cg1)"/>
        <rect x="40" y="74" width="72" height="14" rx="7" fill="#c0ab7c"/>
        <text x="76" y="117" text-anchor="middle" font-size="13" fill="rgba(192,171,124,.9)" font-weight="bold">æ±‚</text>
        <text x="76" y="143" text-anchor="middle" font-size="13" fill="rgba(192,171,124,.9)" font-weight="bold">ç±¤</text>
      </svg>
    </div>
  </div>
</div>
<div class="page" id="pageResult">
  <div class="result-wrap">
    <div class="r-logo-row">
      <img src="https://pydlnqriztpzgxbjuohm.supabase.co/storage/v1/object/public/assets/logo_1771308542401.svg?t=1772192672525" class="r-logo" alt="Logo">
      <div class="r-logo-sep"></div>
      <div class="r-logo-label">å°ç£ä½³å‘³<br>å¥½é‹ç±¤è©©</div>
    </div>
    <div class="f-card">
      <div class="card-hd">
        <div class="card-num" id="cardNum">ç¬¬ä¸€ç±¤</div>
        <div class="badge badge-great" id="cardBadge">å¤§å‰</div>
      </div>
      <div class="card-poem" id="cardPoem"></div>
      <div class="card-sects" id="cardSects"></div>
    </div>
    <div class="r-btns">
      <button class="rbtn rbtn-out" onclick="goToCover()">å†æ±‚ä¸€ç±¤</button>
      <button class="rbtn rbtn-fill" onclick="saveImg()">å„²å­˜çµæœ</button>
    </div>
  </div>
</div>

<div id="hTrigger"></div>
<div id="panel">
  <div class="ph"><h2>âš™ å®¢è£½åŒ–è¨­å®š</h2><button onclick="closePanel()">âœ•</button></div>
  <div class="pb">
    <div class="cr"><label>å°é¢å‰¯æ¨™é¡Œ</label><input type="text" id="cfg-sub" value="æ±‚å¥½é‹ Â· å•å¤©æ©Ÿ"></div>
    <div class="cr"><label>å°é¢æŒ‰éˆ•</label><input type="text" id="cfg-btn" value="æ–ä¸€æ–æ±‚ç±¤"></div>
    <button class="p-btn" onclick="applyAll()">âœ… å¥—ç”¨è¨­å®š</button>
  </div>
</div>

<script>
var fortunes=[
  {num:"ç¬¬ä¸€ç±¤",level:"great",badge:"å¤§å‰",poem:["å¥½é‹é€£é€£æ˜¥æ„æ¿ƒ","ä½³é¤šç¾å‘³æ—¥æ—¥è±","çœŸç å°å‘³è¿ç¦è‡³","è¬äº‹å¦‚æ„å–œæ°£ç›ˆ"],sections:[{label:"ç¸½è«–",text:"æ­¤ç±¤å¤§å‰ï¼Œå¥½é‹æ»¿æº¢ï¼Œè«¸äº‹é †é‚ã€‚"}]},
  {num:"ç¬¬äºŒç±¤",level:"great",badge:"ä¸Šå‰",poem:["å±±çæµ·å‘³å…¥å£ç”˜","å®¶äººå…±èšè©±ç¬‘è«‡","å››å­£å¹³å®‰ç¦å£½é•·","ä¾†å¹´æ›´å‹å¾€å¹´é–“"],sections:[{label:"ç¸½è«–",text:"å®¶åº­å’Œæ¨‚ï¼Œè¦ªæƒ…æº«æš–ã€‚"}]},
  {num:"ç¬¬ä¸‰ç±¤",level:"good",badge:"ä¸­å‰",poem:["éœæ°´æµæ·±è‡ªæœ‰æº","å®ˆå¾—é›²é–‹æœˆæ›´åœ“","è¬äº‹è¬€å®šè€Œå¾Œå‹•","æ˜¥æš–èŠ±é–‹åœ¨çœ¼å‰"],sections:[{label:"ç¸½è«–",text:"æ™‚æ©Ÿæ¼¸ç†Ÿï¼Œéœå¿ƒç­‰å¾…ã€‚"}]}
];
var cur=null,soundOn=true,shakeCount=0,lastA={x:0,y:0,z:0},shakeBlocked=false,tapCount=0,tapTimer=null;

window.addEventListener('load',function(){
  setTimeout(function(){ document.getElementById('preloader').style.display='none'; },1500);
  initGyro();
  document.getElementById('hTrigger').addEventListener('click',function(){
    tapCount++; if(tapTimer)clearTimeout(tapTimer);
    tapTimer=setTimeout(function(){ tapCount=0; },700);
    if(tapCount>=3){ tapCount=0; openPanel(); }
  });
});

function initGyro(){
  if(typeof DeviceOrientationEvent!=='undefined'&&typeof DeviceOrientationEvent.requestPermission==='function'){
    // éœ€è¦æ¬Šé™æŒ‰éˆ•è™•ç†
  } else if(window.DeviceMotionEvent){ window.addEventListener('devicemotion',handleMotion,false); }
}

function handleMotion(e){
  if(!document.getElementById('pageGame').classList.contains('active')||shakeBlocked) return;
  var a=e.accelerationIncludingGravity; if(!a) return;
  var d=Math.abs(a.x-lastA.x)+Math.abs(a.y-lastA.y)+Math.abs(a.z-lastA.z);
  lastA={x:a.x,y:a.y,z:a.z};
  if(d>15){ triggerShake(); }
}

function triggerShake(){
  var can=document.getElementById('shakeCan');
  if(can.classList.contains('shaking')) return;
  can.classList.add('shaking');
  document.getElementById('sticks').style.opacity='1';
  cur=fortunes[Math.floor(Math.random()*fortunes.length)];
  setTimeout(function(){
    can.classList.remove('shaking');
    goToResult();
  },2050);
}

function goToResult(){ renderResult(cur); transition(function(){ showPage('pageResult'); }); }
function transition(cb){ var o=document.getElementById('overlay'); o.classList.add('in'); setTimeout(function(){ cb(); o.classList.remove('in'); },300); }
function showPage(id){ document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); }); document.getElementById(id).classList.add('active'); }
function goToGame(){ transition(function(){ showPage('pageGame'); }); }
function goToCover(){ transition(function(){ showPage('pageCover'); }); }

function renderResult(f){
  document.getElementById('cardNum').textContent=f.num;
  document.getElementById('cardBadge').textContent=f.badge;
  var pe=document.getElementById('cardPoem'); pe.innerHTML='';
  f.poem.forEach(function(l){ var p=document.createElement('p'); p.textContent=l; pe.appendChild(p); });
  var se=document.getElementById('cardSects'); se.innerHTML='';
  f.sections.forEach(function(s){ var d=document.createElement('div'); d.innerHTML='<span class="sect-tag">'+s.label+'</span><span>'+s.text+'</span>'; se.appendChild(d); });
}

function openPanel(){ document.getElementById('panel').classList.add('open'); }
function closePanel(){ document.getElementById('panel').classList.remove('open'); }
function applyAll(){
  document.getElementById('coverSubtitle').textContent=document.getElementById('cfg-sub').value;
  document.getElementById('btnEnterText').textContent=document.getElementById('cfg-btn').value;
  closePanel();
}
function saveImg(){ alert('è«‹é•·æŒ‰ç•«é¢æˆªåœ–å„²å­˜ã€‚'); }
</script>
</body>
</html>
