<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title id="page-title">çœŸç  å°ç£ä½³å‘³ âœ¦ æ±‚å¥½é‹</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700;900&family=Noto+Sans+TC:wght@300;400;500&display=swap');

:root {
  --jade:       #4a8c7f;
  --jade-deep:  #2d6b5e;
  --jade-light: #7bbcad;
  --jade-pale:  #c8e6e0;
  --cream:      #f5f0e8;
  --cream-dark: #e8dfc8;
  --warm-white: #fdf9f4;
  --brown:      #6b4c2a;
  --brown-light:#a07848;
  --tile-red:   #c0392b;
  --tile-teal:  #1a7a6e;
  --text-dark:  #2c2416;
  --text-mid:   #5a4a32;
  --text-light: #9a8870;
  --gold:       #c8a04a;
  --gold-light: #e8c878;
  --shadow:     rgba(44,36,22,0.15);
  --font-serif: 'Noto Serif TC', 'Times New Roman', serif;
  --font-sans:  'Noto Sans TC', sans-serif;
}

*{ box-sizing:border-box; margin:0; padding:0; -webkit-tap-highlight-color:transparent; touch-action:manipulation; }

html,body{ width:100%; height:100%; overflow:hidden; font-family:var(--font-sans); background:var(--cream); }

/* ===== é é¢å®¹å™¨ ===== */
.page{ position:fixed; top:0; left:0; width:100%; height:100%; display:none; overflow:hidden; }
.page.active{ display:block; }

/* ===== é è¼‰ ===== */
#preloader{
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:var(--cream);
  display:flex; align-items:center; justify-content:center; flex-direction:column;
  z-index:9999;
  transition:opacity 0.8s;
}
.preloader-logo{
  width: 80px; height: 80px;
  animation: logoBreath 1.8s ease-in-out infinite;
}
.preloader-text{
  margin-top:16px;
  font-family:var(--font-serif);
  font-size:0.9rem;
  color:var(--jade);
  letter-spacing:0.4em;
}
@keyframes logoBreath{
  0%,100%{ transform:scale(1); opacity:0.8; }
  50%{ transform:scale(1.08); opacity:1; }
}

/* ===== éå ´ ===== */
.overlay{
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:var(--cream);
  z-index:5000; pointer-events:none; opacity:0;
  transition:opacity 0.35s ease;
}
.overlay.in{ opacity:1; pointer-events:all; }

/* ===== éŸ³æ•ˆæŒ‰éˆ• ===== */
#soundBtn{
  position:fixed; top:14px; right:14px;
  width:36px; height:36px;
  background:rgba(255,255,255,0.7);
  border:1px solid var(--jade-pale);
  border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; z-index:200;
  font-size:1rem;
  backdrop-filter:blur(6px);
  transition:all 0.2s;
}

/* ===== å°é¢é  ===== */
#pageCover{
  background: var(--warm-white);
}

/* èŠ±ç£šèƒŒæ™¯ */
.tile-bg{
  position:absolute; top:0; left:0; width:100%; height:100%;
  background-image:
    repeating-linear-gradient(0deg, rgba(74,140,127,0.07) 0px, transparent 1px, transparent 39px, rgba(74,140,127,0.07) 40px),
    repeating-linear-gradient(90deg, rgba(74,140,127,0.07) 0px, transparent 1px, transparent 39px, rgba(74,140,127,0.07) 40px);
  pointer-events:none;
}

/* è¦–å·®å±¤ */
.parallax-wrap{
  position:absolute; top:0; left:0; width:100%; height:100%;
  overflow:hidden;
}
.layer{ position:absolute; will-change:transform; transition:transform 0.25s ease-out; }

/* åº•éƒ¨èŠ±ç£šå¸¶ */
.layer-base{
  bottom:0; left:0; width:100%; height:40%;
  background: linear-gradient(180deg, transparent 0%, rgba(74,140,127,0.12) 40%, rgba(74,140,127,0.28) 100%);
}

/* å¤§åœ“åœˆè£é£¾ */
.layer-circle{
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  width:min(80vw, 360px); height:min(80vw, 360px);
}

/* ä¸»è¦èŠ±å‰æ’ç•« */
.layer-flower{
  top:50%; left:50%;
  transform:translate(-50%,-58%);
  width:min(54vw, 240px);
  animation: gentleFloat 5s ease-in-out infinite;
}
@keyframes gentleFloat{
  0%,100%{ margin-top:0; }
  50%{ margin-top:-10px; }
}

/* å·¦å³è£é£¾ */
.layer-left{
  top:30%; left:-2%;
  width:min(18vw,80px);
}
.layer-right{
  top:35%; right:-2%;
  width:min(18vw,80px);
}

/* æ¨™é¡Œå€ */
.cover-header{
  position:absolute;
  top:8%;
  left:0; right:0;
  text-align:center;
  z-index:10;
}
.cover-logo-text{
  display:inline-block;
}
.cover-logo-text .main-title{
  font-family:var(--font-serif);
  font-size:clamp(2rem,9vw,3.2rem);
  font-weight:900;
  color:var(--jade-deep);
  letter-spacing:0.2em;
  line-height:1;
  text-shadow:0 2px 8px rgba(74,140,127,0.2);
}
.cover-logo-text .en-title{
  font-family:var(--font-sans);
  font-size:clamp(0.65rem,2.8vw,0.85rem);
  font-weight:300;
  color:var(--jade);
  letter-spacing:0.6em;
  margin-top:4px;
  display:block;
}
.cover-divider{
  display:flex; align-items:center; justify-content:center;
  gap:10px;
  margin-top:10px;
}
.cover-divider span{
  height:1px; width:30px;
  background: linear-gradient(90deg, transparent, var(--jade), transparent);
}
.cover-divider i{
  font-style:normal;
  color:var(--jade);
  font-size:0.7rem;
  letter-spacing:0.3em;
}
.cover-subtitle{
  margin-top:8px;
  font-size:clamp(0.8rem,3.2vw,1rem);
  color:var(--text-light);
  letter-spacing:0.25em;
  font-weight:300;
}

/* é€²å…¥æŒ‰éˆ• */
.btn-enter-wrap{
  position:absolute;
  bottom:10%;
  left:50%; transform:translateX(-50%);
  z-index:10;
  cursor:pointer;
}
.btn-enter-jinzhu{
  background:var(--jade);
  color:var(--warm-white);
  font-family:var(--font-serif);
  font-size:clamp(1rem,4.5vw,1.2rem);
  font-weight:600;
  letter-spacing:0.4em;
  padding:15px 44px;
  border-radius:60px;
  border:none;
  box-shadow:0 6px 24px rgba(74,140,127,0.35), inset 0 1px 0 rgba(255,255,255,0.2);
  transition:all 0.2s;
  position:relative;
  overflow:hidden;
  white-space:nowrap;
}
.btn-enter-jinzhu::before{
  content:'';
  position:absolute; top:0; left:-100%; width:100%; height:100%;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.15),transparent);
  transition:left 0.4s;
}
.btn-enter-wrap:active .btn-enter-jinzhu{ transform:scale(0.97); box-shadow:0 3px 12px rgba(74,140,127,0.3); }
.btn-enter-wrap:hover .btn-enter-jinzhu::before{ left:100%; }

/* å°èŠ±æœµç²’å­ */
.petal{
  position:absolute;
  pointer-events:none;
  animation:petalDrift linear infinite;
  z-index:3;
}
@keyframes petalDrift{
  0%{ transform:translateY(-30px) rotate(0deg) scale(0); opacity:0; }
  5%{ opacity:1; transform:translateY(0) rotate(30deg) scale(1); }
  95%{ opacity:0.3; }
  100%{ transform:translateY(105vh) rotate(720deg) scale(0.5); opacity:0; }
}

/* ===== æ–ç±¤é  ===== */
#pageGame{
  background: linear-gradient(160deg, var(--warm-white) 0%, var(--cream) 100%);
}

/* èŠ±ç£šèƒŒæ™¯ */
#pageGame .tile-bg{
  opacity:0.5;
}

.game-wrap{
  position:relative;
  width:100%; height:100%;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
}

.game-header{
  position:absolute;
  top:8%; left:0; right:0;
  text-align:center;
}
.game-header h2{
  font-family:var(--font-serif);
  font-size:clamp(1.1rem,5vw,1.5rem);
  color:var(--jade-deep);
  letter-spacing:0.2em;
  font-weight:700;
}

.shake-instruction{
  position:absolute;
  top:18%; left:0; right:0;
  text-align:center;
  transition:opacity 0.5s, transform 0.5s;
}
.shake-instruction.hidden{
  opacity:0; transform:translateY(-10px); pointer-events:none;
}
.shake-instruction p{
  font-family:var(--font-serif);
  font-size:clamp(0.9rem,4vw,1.15rem);
  color:var(--text-mid);
  line-height:2;
  letter-spacing:0.1em;
}
.shake-instruction p em{
  font-style:normal;
  color:var(--jade);
  font-weight:600;
}

/* ç±¤ç­’å®¹å™¨ */
.can-container{
  position:relative;
  cursor:pointer;
  margin-bottom:10px;
}
.shake-can{
  width:min(42vw, 168px);
  height:min(52vw, 210px);
  transition:transform 0.1s;
}
.shake-can.shaking{
  animation:canShake 2s cubic-bezier(0.36,0.07,0.19,0.97);
}
@keyframes canShake{
  0%{ transform:rotate(0deg); }
  4%{ transform:rotate(-18deg) translateX(-4px); }
  8%{ transform:rotate(18deg) translateX(4px); }
  12%{ transform:rotate(-22deg) translateX(-6px); }
  16%{ transform:rotate(22deg) translateX(6px); }
  20%{ transform:rotate(-18deg) translateX(-4px); }
  24%{ transform:rotate(18deg) translateX(4px); }
  28%{ transform:rotate(-22deg) translateX(-6px); }
  32%{ transform:rotate(22deg) translateX(6px); }
  36%{ transform:rotate(-14deg) translateX(-3px); }
  40%{ transform:rotate(14deg) translateX(3px); }
  50%{ transform:rotate(-8deg) translateX(-2px); }
  60%{ transform:rotate(8deg) translateX(2px); }
  75%{ transform:rotate(-4deg) translateX(-1px); }
  90%{ transform:rotate(2deg); }
  100%{ transform:rotate(0deg); }
}

.tap-hint{
  text-align:center;
  margin-top:16px;
  font-size:clamp(0.75rem,3vw,0.9rem);
  color:var(--text-light);
  letter-spacing:0.2em;
  animation:blinkPulse 2.5s ease-in-out infinite;
}
@keyframes blinkPulse{
  0%,100%{ opacity:0.4; }
  50%{ opacity:0.9; }
}

.btn-see-result{
  position:absolute;
  bottom:10%;
  background:var(--jade);
  color:var(--warm-white);
  font-family:var(--font-serif);
  font-size:clamp(0.95rem,4vw,1.15rem);
  font-weight:600;
  letter-spacing:0.3em;
  padding:14px 40px;
  border-radius:60px;
  border:none;
  box-shadow:0 6px 24px rgba(74,140,127,0.35);
  cursor:pointer;
  display:none;
  z-index:10;
  transition:all 0.2s;
  animation:btnAppear 0.5s cubic-bezier(0.34,1.56,0.64,1) forwards;
}
@keyframes btnAppear{
  from{ opacity:0; transform:scale(0.8) translateY(10px); }
  to{ opacity:1; transform:scale(1) translateY(0); }
}
.btn-see-result:active{ transform:scale(0.96); }

/* ===== çµæœé  ===== */
#pageResult{
  background:var(--warm-white);
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
}

.result-page-wrap{
  min-height:100%;
  display:flex; flex-direction:column; align-items:center;
  padding:36px 20px 40px;
}

/* çµæœé é ‚éƒ¨è£é£¾ */
.result-deco-top{
  width:100%; max-width:380px;
  text-align:center;
  margin-bottom:20px;
}
.result-deco-top .deco-line{
  display:flex; align-items:center; justify-content:center; gap:12px;
  margin-bottom:12px;
}
.result-deco-top .deco-line span{
  flex:1; height:1px;
  background:linear-gradient(90deg,transparent,var(--jade-light));
}
.result-deco-top .deco-line span:last-child{
  background:linear-gradient(90deg,var(--jade-light),transparent);
}
.result-deco-top .deco-line em{
  font-style:normal;
  color:var(--jade);
  font-size:0.9rem;
}
.result-main-title{
  font-family:var(--font-serif);
  font-size:clamp(1.4rem,6vw,2.2rem);
  color:var(--jade-deep);
  font-weight:900;
  letter-spacing:0.25em;
}

/* ç±¤å¡ */
.fortune-card{
  width:100%; max-width:380px;
  background:var(--warm-white);
  border:1.5px solid var(--jade-pale);
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 8px 40px rgba(74,140,127,0.12), 0 2px 8px rgba(44,36,22,0.08);
  animation:cardIn 0.7s cubic-bezier(0.34,1.56,0.64,1) forwards;
}
@keyframes cardIn{
  from{ opacity:0; transform:translateY(30px) scale(0.95); }
  to{ opacity:1; transform:translateY(0) scale(1); }
}

/* å¡ç‰‡é ‚éƒ¨å½©è‰²å¸¶ - å°å¼èŠ±ç£šé¢¨æ ¼ */
.card-top-band{
  height:8px;
  background:linear-gradient(90deg, var(--jade-deep) 0%, var(--jade-light) 50%, var(--jade-deep) 100%);
}

.card-header{
  padding:24px 24px 16px;
  text-align:center;
  background:linear-gradient(180deg, rgba(200,230,224,0.2) 0%, transparent 100%);
  border-bottom:1px solid var(--jade-pale);
}
.card-num{
  font-family:var(--font-serif);
  font-size:clamp(1.3rem,5.5vw,1.8rem);
  font-weight:900;
  color:var(--jade-deep);
  letter-spacing:0.15em;
}
.card-level-row{
  margin-top:8px;
  display:flex; align-items:center; justify-content:center; gap:8px;
}
.level-badge{
  display:inline-flex; align-items:center;
  padding:5px 18px;
  border-radius:30px;
  font-family:var(--font-serif);
  font-size:clamp(0.85rem,3.5vw,1rem);
  font-weight:700;
  letter-spacing:0.15em;
}
.badge-great{ background:linear-gradient(135deg,#4a8c7f,#2d6b5e); color:#fdf9f4; }
.badge-good{  background:linear-gradient(135deg,#5a9e6a,#3a7a4a); color:#fdf9f4; }
.badge-ok{    background:linear-gradient(135deg,#8a7a5a,#6a5a3a); color:#fdf9f4; }
.badge-bad{   background:linear-gradient(135deg,#8a8a8a,#5a5a5a); color:#fdf9f4; }

/* ç±¤è©© */
.card-poem{
  padding:20px 24px;
  border-bottom:1px solid rgba(74,140,127,0.15);
  text-align:center;
  background:
    radial-gradient(ellipse at 50% 50%, rgba(200,230,224,0.12) 0%, transparent 70%);
}
.card-poem p{
  font-family:var(--font-serif);
  font-size:clamp(0.95rem,4vw,1.1rem);
  color:var(--text-dark);
  line-height:2.4;
  letter-spacing:0.2em;
}

/* è§£èªªå€ */
.card-sections{ padding:16px 20px 20px; }
.card-section{
  display:flex; align-items:flex-start;
  padding:10px 0;
  border-bottom:1px dashed rgba(74,140,127,0.2);
}
.card-section:last-child{ border-bottom:none; }
.section-tag{
  flex:0 0 auto;
  background:rgba(74,140,127,0.1);
  border:1px solid rgba(74,140,127,0.3);
  color:var(--jade-deep);
  font-size:0.72rem;
  font-weight:600;
  padding:3px 10px;
  border-radius:20px;
  letter-spacing:0.1em;
  margin-right:12px;
  margin-top:3px;
  white-space:nowrap;
  font-family:var(--font-sans);
}
.section-body{
  color:var(--text-mid);
  font-size:clamp(0.82rem,3.2vw,0.92rem);
  line-height:1.9;
  letter-spacing:0.05em;
  font-family:var(--font-sans);
}

/* èŠ±ç£šè§’è½è£é£¾ */
.tile-corner{
  position:absolute;
  width:48px; height:48px;
  opacity:0.15;
  pointer-events:none;
}
.tile-corner.tl{ top:0; left:0; }
.tile-corner.tr{ top:0; right:0; transform:scaleX(-1); }
.tile-corner.bl{ bottom:0; left:0; transform:scaleY(-1); }
.tile-corner.br{ bottom:0; right:0; transform:scale(-1); }

/* æŒ‰éˆ•çµ„ */
.result-btns{
  display:flex; gap:12px;
  margin-top:20px;
  width:100%; max-width:380px;
}
.rbtn{
  flex:1; padding:14px 10px;
  border-radius:60px;
  font-family:var(--font-serif);
  font-size:clamp(0.85rem,3.5vw,1rem);
  font-weight:600;
  letter-spacing:0.2em;
  cursor:pointer;
  transition:all 0.2s;
  border:none;
}
.rbtn:active{ transform:scale(0.96); }
.rbtn-outline{
  background:transparent;
  border:1.5px solid var(--jade) !important;
  color:var(--jade-deep);
}
.rbtn-fill{
  background:var(--jade);
  color:var(--warm-white);
  box-shadow:0 4px 16px rgba(74,140,127,0.3);
}

/* å“ç‰Œåº•éƒ¨ */
.brand-footer{
  margin-top:24px;
  text-align:center;
  color:var(--text-light);
  font-size:0.72rem;
  letter-spacing:0.3em;
  font-family:var(--font-sans);
}

/* ===== é™€èºå„€å½ˆçª— ===== */
.perm-dialog{
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(44,36,22,0.5);
  backdrop-filter:blur(4px);
  display:none; align-items:center; justify-content:center;
  z-index:1000;
}
.perm-dialog.show{ display:flex; }
.perm-box{
  background:var(--warm-white);
  border-radius:16px;
  padding:32px 28px;
  max-width:300px;
  text-align:center;
  box-shadow:0 20px 60px rgba(44,36,22,0.2);
}
.perm-box h3{
  font-family:var(--font-serif);
  color:var(--jade-deep);
  font-size:1.1rem;
  margin-bottom:10px;
  letter-spacing:0.1em;
}
.perm-box p{
  color:var(--text-mid);
  font-size:0.88rem;
  line-height:1.8;
  margin-bottom:20px;
}
.perm-box button{
  background:var(--jade);
  color:var(--warm-white);
  font-family:var(--font-serif);
  font-size:1rem;
  font-weight:600;
  letter-spacing:0.2em;
  padding:12px 32px;
  border-radius:60px;
  border:none;
  cursor:pointer;
}

/* ===== éš±è—å®¢è£½åŒ–é¢æ¿ ===== */
/* è§¸ç™¼å€ï¼šå³ä¸‹è§’ 30x30 é€æ˜ç†±å€ï¼Œéœ€å¿«é€Ÿé»æ“Š 3 æ¬¡ */
#hiddenTrigger{
  position:fixed;
  bottom:0; right:0;
  width:50px; height:50px;
  z-index:9990;
  cursor:default;
}

#customPanel{
  position:fixed;
  bottom:-100%;
  left:0; right:0;
  max-height:80%;
  background:var(--warm-white);
  border-top:2px solid var(--jade);
  border-radius:20px 20px 0 0;
  z-index:9995;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  transition:bottom 0.4s cubic-bezier(0.34,1.2,0.64,1);
  padding:0 0 30px;
  box-shadow:0 -8px 40px rgba(74,140,127,0.2);
}
#customPanel.open{ bottom:0; }

.panel-handle{
  display:flex; align-items:center; justify-content:space-between;
  padding:16px 20px 12px;
  border-bottom:1px solid var(--jade-pale);
  position:sticky; top:0;
  background:var(--warm-white);
  z-index:1;
}
.panel-handle h2{
  font-family:var(--font-serif);
  font-size:1rem;
  color:var(--jade-deep);
  letter-spacing:0.2em;
}
.panel-close{
  background:none; border:none;
  color:var(--text-light); font-size:1.4rem;
  cursor:pointer; line-height:1;
  padding:0 4px;
}

.panel-body{ padding:16px 20px; }

.cfg-section{ margin-bottom:20px; }
.cfg-section h3{
  font-size:0.75rem;
  font-weight:600;
  color:var(--jade);
  letter-spacing:0.3em;
  text-transform:uppercase;
  margin-bottom:10px;
  padding-bottom:6px;
  border-bottom:1px solid var(--jade-pale);
}
.cfg-row{ margin-bottom:10px; }
.cfg-row label{
  display:block;
  font-size:0.78rem;
  color:var(--text-light);
  margin-bottom:4px;
  letter-spacing:0.05em;
}
.cfg-row input, .cfg-row textarea, .cfg-row select{
  width:100%;
  border:1.5px solid var(--jade-pale);
  border-radius:8px;
  padding:8px 12px;
  color:var(--text-dark);
  font-family:var(--font-sans);
  font-size:0.85rem;
  outline:none;
  background:var(--warm-white);
  transition:border-color 0.2s;
}
.cfg-row input:focus, .cfg-row textarea:focus{ border-color:var(--jade); }
.cfg-row textarea{ height:72px; resize:vertical; }
.cfg-row input[type="color"]{ height:36px; padding:2px 4px; cursor:pointer; }

.cfg-apply{
  width:100%;
  background:var(--jade);
  color:var(--warm-white);
  font-family:var(--font-serif);
  font-size:1rem;
  font-weight:600;
  letter-spacing:0.3em;
  padding:13px;
  border-radius:60px;
  border:none;
  cursor:pointer;
  transition:all 0.2s;
  margin-top:4px;
}
.cfg-apply:active{ transform:scale(0.98); }

/* ç±¤è©©åˆ—è¡¨ */
.fortune-item{
  border:1px solid var(--jade-pale);
  border-radius:10px;
  padding:12px;
  margin-bottom:10px;
}
.fortune-item-head{
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:10px;
}
.fortune-item-head span{
  font-size:0.82rem;
  color:var(--jade-deep);
  font-weight:600;
}
.fortune-item-head button{
  background:none; border:none;
  color:rgba(192,57,43,0.6);
  cursor:pointer; font-size:1rem;
}
</style>
</head>
<body>

<!-- é è¼‰ -->
<div id="preloader">
  <svg class="preloader-logo" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <circle cx="40" cy="40" r="36" fill="none" stroke="#c8e6e0" stroke-width="2"/>
    <!-- ç°¡åŒ–è·èŠ± -->
    <ellipse cx="40" cy="32" rx="8" ry="14" fill="#4a8c7f" opacity="0.9" transform="rotate(0,40,42)"/>
    <ellipse cx="40" cy="32" rx="8" ry="14" fill="#4a8c7f" opacity="0.9" transform="rotate(60,40,42)"/>
    <ellipse cx="40" cy="32" rx="8" ry="14" fill="#4a8c7f" opacity="0.9" transform="rotate(120,40,42)"/>
    <ellipse cx="40" cy="32" rx="8" ry="14" fill="#4a8c7f" opacity="0.9" transform="rotate(180,40,42)"/>
    <ellipse cx="40" cy="32" rx="8" ry="14" fill="#4a8c7f" opacity="0.9" transform="rotate(240,40,42)"/>
    <ellipse cx="40" cy="32" rx="8" ry="14" fill="#4a8c7f" opacity="0.9" transform="rotate(300,40,42)"/>
    <circle cx="40" cy="42" r="9" fill="#7bbcad"/>
    <circle cx="40" cy="42" r="5" fill="#c8e6e0"/>
  </svg>
  <div class="preloader-text">çœŸ ç  å° ç£ ä½³ å‘³</div>
</div>

<!-- éå ´ -->
<div class="overlay" id="overlay"></div>

<!-- éŸ³æ•ˆ -->
<button id="soundBtn" title="éŸ³æ•ˆ">ğŸ”Š</button>

<!-- ===== å°é¢é  ===== -->
<div class="page active" id="pageCover">
  <div class="tile-bg"></div>
  
  <div class="parallax-wrap">
    <!-- å¤§åœ“åœˆ -->
    <div class="layer layer-circle" id="lCircle">
      <svg viewBox="0 0 360 360" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
        <circle cx="180" cy="180" r="170" fill="rgba(200,230,224,0.18)" stroke="rgba(74,140,127,0.25)" stroke-width="1.5"/>
        <circle cx="180" cy="180" r="145" fill="none" stroke="rgba(74,140,127,0.12)" stroke-width="1" stroke-dasharray="4 8"/>
        <circle cx="180" cy="180" r="120" fill="none" stroke="rgba(74,140,127,0.08)" stroke-width="1"/>
      </svg>
    </div>

    <!-- è·èŠ±åº•éƒ¨ -->
    <div class="layer" id="lBase" style="position:absolute;bottom:0;left:0;width:100%;height:38%;">
      <svg viewBox="0 0 400 180" width="100%" height="100%" preserveAspectRatio="xMidYMax slice" xmlns="http://www.w3.org/2000/svg">
        <!-- æ°´é¢ -->
        <rect x="0" y="130" width="400" height="50" fill="rgba(74,140,127,0.15)" rx="0"/>
        <ellipse cx="200" cy="130" rx="200" ry="15" fill="rgba(74,140,127,0.1)"/>
        <!-- è·è‘‰ -->
        <ellipse cx="70" cy="132" rx="55" ry="14" fill="rgba(74,140,127,0.3)"/>
        <ellipse cx="200" cy="135" rx="70" ry="16" fill="rgba(74,140,127,0.25)"/>
        <ellipse cx="330" cy="131" rx="50" ry="13" fill="rgba(74,140,127,0.28)"/>
        <!-- è·è– -->
        <line x1="70" y1="130" x2="72" y2="80" stroke="rgba(74,140,127,0.4)" stroke-width="3"/>
        <line x1="200" y1="132" x2="200" y2="60" stroke="rgba(74,140,127,0.4)" stroke-width="4"/>
        <line x1="330" y1="130" x2="328" y2="85" stroke="rgba(74,140,127,0.4)" stroke-width="3"/>
        <line x1="150" y1="133" x2="148" y2="100" stroke="rgba(74,140,127,0.3)" stroke-width="2.5"/>
        <!-- èŠ±è‹ -->
        <ellipse cx="72" cy="70" rx="14" ry="20" fill="rgba(74,140,127,0.6)"/>
        <ellipse cx="148" cy="90" rx="11" ry="16" fill="rgba(74,140,127,0.5)"/>
        <ellipse cx="328" cy="74" rx="15" ry="22" fill="rgba(74,140,127,0.6)"/>
      </svg>
    </div>

    <!-- ä¸»èŠ± -->
    <div class="layer layer-flower" id="lFlower">
      <svg viewBox="0 0 220 240" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
        <!-- è–è‘‰ -->
        <line x1="110" y1="185" x2="110" y2="240" stroke="#4a8c7f" stroke-width="5" stroke-linecap="round"/>
        <path d="M110 215 Q75 185 58 155 Q90 168 110 200" fill="#5a9e6a" opacity="0.85"/>
        <path d="M110 215 Q145 185 162 155 Q130 168 110 200" fill="#5a9e6a" opacity="0.85"/>
        <!-- å¤–å±¤èŠ±ç“£ (æ·ºç¿ ç¶ ) -->
        <ellipse cx="110" cy="88" rx="20" ry="38" fill="#7bbcad" opacity="0.75" transform="rotate(0,110,118)"/>
        <ellipse cx="110" cy="88" rx="20" ry="38" fill="#7bbcad" opacity="0.75" transform="rotate(40,110,118)"/>
        <ellipse cx="110" cy="88" rx="20" ry="38" fill="#7bbcad" opacity="0.75" transform="rotate(80,110,118)"/>
        <ellipse cx="110" cy="88" rx="20" ry="38" fill="#7bbcad" opacity="0.75" transform="rotate(120,110,118)"/>
        <ellipse cx="110" cy="88" rx="20" ry="38" fill="#7bbcad" opacity="0.75" transform="rotate(160,110,118)"/>
        <ellipse cx="110" cy="88" rx="20" ry="38" fill="#7bbcad" opacity="0.75" transform="rotate(200,110,118)"/>
        <ellipse cx="110" cy="88" rx="20" ry="38" fill="#7bbcad" opacity="0.75" transform="rotate(240,110,118)"/>
        <ellipse cx="110" cy="88" rx="20" ry="38" fill="#7bbcad" opacity="0.75" transform="rotate(280,110,118)"/>
        <ellipse cx="110" cy="88" rx="20" ry="38" fill="#7bbcad" opacity="0.75" transform="rotate(320,110,118)"/>
        <!-- å…§å±¤èŠ±ç“£ (ç¿ ç‰) -->
        <ellipse cx="110" cy="95" rx="14" ry="27" fill="#4a8c7f" opacity="0.9" transform="rotate(20,110,118)"/>
        <ellipse cx="110" cy="95" rx="14" ry="27" fill="#4a8c7f" opacity="0.9" transform="rotate(60,110,118)"/>
        <ellipse cx="110" cy="95" rx="14" ry="27" fill="#4a8c7f" opacity="0.9" transform="rotate(100,110,118)"/>
        <ellipse cx="110" cy="95" rx="14" ry="27" fill="#4a8c7f" opacity="0.9" transform="rotate(140,110,118)"/>
        <ellipse cx="110" cy="95" rx="14" ry="27" fill="#4a8c7f" opacity="0.9" transform="rotate(180,110,118)"/>
        <ellipse cx="110" cy="95" rx="14" ry="27" fill="#4a8c7f" opacity="0.9" transform="rotate(220,110,118)"/>
        <ellipse cx="110" cy="95" rx="14" ry="27" fill="#4a8c7f" opacity="0.9" transform="rotate(260,110,118)"/>
        <ellipse cx="110" cy="95" rx="14" ry="27" fill="#4a8c7f" opacity="0.9" transform="rotate(300,110,118)"/>
        <ellipse cx="110" cy="95" rx="14" ry="27" fill="#4a8c7f" opacity="0.9" transform="rotate(340,110,118)"/>
        <!-- èŠ±å¿ƒ -->
        <circle cx="110" cy="118" r="18" fill="#c8e6e0"/>
        <circle cx="110" cy="118" r="13" fill="#7bbcad"/>
        <circle cx="110" cy="118" r="8" fill="#4a8c7f"/>
        <!-- èŠ±è•Š -->
        <circle cx="110" cy="112" r="2" fill="#c8e6e0"/>
        <circle cx="116" cy="116" r="1.8" fill="#c8e6e0"/>
        <circle cx="104" cy="116" r="1.8" fill="#c8e6e0"/>
        <circle cx="113" cy="122" r="1.8" fill="#c8e6e0"/>
        <circle cx="107" cy="122" r="1.8" fill="#c8e6e0"/>
        <circle cx="110" cy="124" r="2" fill="#c8e6e0"/>
      </svg>
    </div>

    <!-- å·¦è£é£¾ç«¹ -->
    <div class="layer layer-left" id="lLeft">
      <svg viewBox="0 0 80 200" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
        <line x1="40" y1="200" x2="40" y2="0" stroke="rgba(74,140,127,0.25)" stroke-width="8" stroke-linecap="round"/>
        <ellipse cx="40" cy="70" rx="6" ry="3" fill="rgba(74,140,127,0.3)"/>
        <ellipse cx="40" cy="120" rx="6" ry="3" fill="rgba(74,140,127,0.3)"/>
        <ellipse cx="40" cy="170" rx="6" ry="3" fill="rgba(74,140,127,0.3)"/>
        <path d="M40 80 Q10 60 5 30 Q30 50 40 75" fill="rgba(90,158,106,0.3)"/>
        <path d="M40 130 Q10 110 5 80 Q30 100 40 125" fill="rgba(90,158,106,0.25)"/>
      </svg>
    </div>

    <!-- å³è£é£¾ç«¹ -->
    <div class="layer layer-right" id="lRight">
      <svg viewBox="0 0 80 200" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
        <line x1="40" y1="200" x2="40" y2="0" stroke="rgba(74,140,127,0.25)" stroke-width="8" stroke-linecap="round"/>
        <ellipse cx="40" cy="70" rx="6" ry="3" fill="rgba(74,140,127,0.3)"/>
        <ellipse cx="40" cy="120" rx="6" ry="3" fill="rgba(74,140,127,0.3)"/>
        <ellipse cx="40" cy="170" rx="6" ry="3" fill="rgba(74,140,127,0.3)"/>
        <path d="M40 80 Q70 60 75 30 Q50 50 40 75" fill="rgba(90,158,106,0.3)"/>
        <path d="M40 130 Q70 110 75 80 Q50 100 40 125" fill="rgba(90,158,106,0.25)"/>
      </svg>
    </div>
  </div>

  <!-- æ¨™é¡Œ -->
  <div class="cover-header">
    <div class="cover-logo-text">
      <div class="main-title" id="coverTitle">çœŸç  å°ç£ä½³å‘³</div>
      <span class="en-title">JIN - ZHU</span>
    </div>
    <div class="cover-divider">
      <span></span>
      <i id="coverSubtitle">æ±‚å¥½é‹ Â· å•å¤©æ©Ÿ</i>
      <span></span>
    </div>
  </div>

  <!-- é€²å…¥æŒ‰éˆ• -->
  <div class="btn-enter-wrap" onclick="goToGame()">
    <button class="btn-enter-jinzhu" id="btnEnterText">æ–ä¸€æ–æ±‚ç±¤</button>
  </div>

  <!-- é™€èºå„€å½ˆçª— -->
  <div class="perm-dialog" id="permDialog">
    <div class="perm-box">
      <h3>éœ€è¦é™€èºå„€æ¬Šé™</h3>
      <p>è«‹æˆæ¬Šä½¿ç”¨è¨­å‚™é™€èºå„€åŠŸèƒ½ï¼Œé«”é©—è¦–å·®å‹•æ…‹æ•ˆæœã€‚</p>
      <button onclick="requestPerm()">æˆ æ¬Š</button>
    </div>
  </div>
</div>

<!-- ===== æ–ç±¤é  ===== -->
<div class="page" id="pageGame">
  <div class="tile-bg"></div>
  <div class="game-wrap">
    <div class="game-header">
      <h2 id="gameTitle">âœ¦ çœŸç å¥½é‹ç±¤ âœ¦</h2>
    </div>
    <div class="shake-instruction" id="shakeInstruction">
      <p><em id="shakeTipText">é»˜å¿µå¿ƒä¸­é¡˜æœ›</em><br>æ–æ™ƒæ‰‹æ©Ÿ æˆ– é»æ“Šç±¤ç­’</p>
    </div>

    <div class="can-container">
      <div class="shake-can" id="shakeCan" onclick="doShake()">
        <svg viewBox="0 0 168 210" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
          <defs>
            <linearGradient id="cg1" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#2d6b5e"/>
              <stop offset="35%" stop-color="#4a8c7f"/>
              <stop offset="65%" stop-color="#5a9e8f"/>
              <stop offset="100%" stop-color="#2d6b5e"/>
            </linearGradient>
            <linearGradient id="cg2" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stop-color="#7bbcad"/>
              <stop offset="100%" stop-color="#4a8c7f"/>
            </linearGradient>
          </defs>
          <!-- ç±¤ç«¹ -->
          <g id="sticks" opacity="0" style="transition:opacity 0.3s;">
            <rect x="62" y="16" width="7" height="82" rx="3.5" fill="#a07848" transform="rotate(-18,65,58)"/>
            <rect x="74" y="10" width="7" height="88" rx="3.5" fill="#c8a04a"/>
            <rect x="86" y="14" width="7" height="84" rx="3.5" fill="#a07848" transform="rotate(12,89,56)"/>
            <rect x="98" y="11" width="6" height="86" rx="3" fill="#c8a04a" transform="rotate(-8,101,54)"/>
            <!-- ç±¤å­— -->
            <text x="77" y="65" font-size="9" fill="rgba(44,36,22,0.8)" font-family="serif">ç±¤</text>
          </g>
          <!-- ç±¤ç­’åº• -->
          <ellipse cx="84" cy="192" rx="38" ry="8" fill="#2d6b5e"/>
          <!-- ä¸»é«” -->
          <rect x="46" y="88" width="76" height="108" rx="8" fill="url(#cg1)"/>
          <!-- é ‚ç’° -->
          <rect x="44" y="82" width="80" height="16" rx="8" fill="url(#cg2)"/>
          <ellipse cx="84" cy="82" rx="40" ry="8" fill="url(#cg2)"/>
          <!-- èŠ±ç£šåœ–æ¡ˆ -->
          <g opacity="0.35" fill="none" stroke="#c8e6e0" stroke-width="1">
            <rect x="57" y="100" width="16" height="16" rx="2"/>
            <line x1="57" y1="108" x2="73" y2="108"/>
            <line x1="65" y1="100" x2="65" y2="116"/>
            <rect x="95" y="100" width="16" height="16" rx="2"/>
            <line x1="95" y1="108" x2="111" y2="108"/>
            <line x1="103" y1="100" x2="103" y2="116"/>
            <rect x="57" y="155" width="16" height="16" rx="2"/>
            <line x1="57" y1="163" x2="73" y2="163"/>
            <line x1="65" y1="155" x2="65" y2="171"/>
            <rect x="95" y="155" width="16" height="16" rx="2"/>
            <line x1="95" y1="163" x2="111" y2="163"/>
            <line x1="103" y1="155" x2="103" y2="171"/>
          </g>
          <!-- ä¸­é–“é‡‘æ©«ç·š -->
          <rect x="46" y="133" width="76" height="1.5" fill="rgba(200,160,74,0.5)"/>
          <!-- ä¸»æ–‡å­— -->
          <text x="84" y="123" text-anchor="middle" font-size="15" fill="rgba(200,230,224,0.9)" font-family="serif" font-weight="bold" letter-spacing="3">æ±‚</text>
          <text x="84" y="152" text-anchor="middle" font-size="15" fill="rgba(200,230,224,0.9)" font-family="serif" font-weight="bold" letter-spacing="3">ç±¤</text>
          <!-- é ‚éƒ¨æ–‡å­— -->
          <text x="84" y="92" text-anchor="middle" font-size="9" fill="rgba(200,230,224,0.7)" font-family="sans-serif" letter-spacing="1">çœŸ ç </text>
        </svg>
      </div>
    </div>
    
    <div class="tap-hint" id="tapHint">è¼•è§¸ç±¤ç­’ æˆ– æ–æ™ƒæ‰‹æ©Ÿ</div>
    
    <button class="btn-see-result" id="btnSeeResult" onclick="goToResult()">æŸ¥çœ‹ç±¤è©©è§£èªª</button>
  </div>
</div>

<!-- ===== çµæœé  ===== -->
<div class="page" id="pageResult">
  <div class="result-page-wrap">
    <div class="result-deco-top">
      <div class="deco-line">
        <span></span>
        <em>âœ¦</em>
        <span></span>
      </div>
      <div class="result-main-title" id="resultTitle">çœŸç å¥½é‹ç±¤</div>
      <div class="deco-line" style="margin-top:10px;">
        <span></span>
        <em>âœ¦</em>
        <span></span>
      </div>
    </div>

    <div class="fortune-card" id="fortuneCard">
      <div class="card-top-band"></div>
      <div class="card-header">
        <div class="card-num" id="cardNum">ç¬¬ä¸€ç±¤</div>
        <div class="card-level-row">
          <span class="level-badge badge-great" id="cardBadge">å¤§å‰</span>
        </div>
      </div>
      <div class="card-poem" id="cardPoem">
        <p>å¥½é‹é€£é€£æ˜¥æ„æ¿ƒ</p>
        <p>ä½³é¤šç¾å‘³æ—¥æ—¥è±</p>
        <p>çœŸç å°å‘³è¿ç¦è‡³</p>
        <p>è¬äº‹å¦‚æ„å–œæ°£ç›ˆ</p>
      </div>
      <div class="card-sections" id="cardSections">
        <div class="card-section">
          <span class="section-tag">ç¸½è«–</span>
          <span class="section-body">æ­¤ç±¤å¤§å‰ï¼Œè«¸äº‹é †é‚ï¼Œå¥½é‹ç•¶é ­ï¼ŒæŠŠæ¡è‰¯æ©Ÿã€‚</span>
        </div>
      </div>
    </div>

    <div class="result-btns">
      <button class="rbtn rbtn-outline" onclick="goToCover()">å†æ±‚ä¸€ç±¤</button>
      <button class="rbtn rbtn-fill" onclick="saveImg()">å„²å­˜çµæœ</button>
    </div>
    <div class="brand-footer">
      çœŸç  å°ç£ä½³å‘³ Â· JIN-ZHU Â· å°ç£å¥½å‘³é“
    </div>
  </div>
</div>

<!-- ===== éš±è—ç†±å€ (å³ä¸‹è§’å¿«é€Ÿä¸‰æ“Š) ===== -->
<div id="hiddenTrigger"></div>

<!-- ===== å®¢è£½åŒ–é¢æ¿ ===== -->
<div id="customPanel">
  <div class="panel-handle">
    <h2>âš™ å®¢è£½åŒ–è¨­å®š</h2>
    <button class="panel-close" onclick="closePanel()">âœ•</button>
  </div>
  <div class="panel-body">
    
    <div class="cfg-section">
      <h3>åŸºæœ¬æ–‡å­—</h3>
      <div class="cfg-row">
        <label>å°é¢å¤§æ¨™é¡Œ</label>
        <input type="text" id="cfg-title" value="çœŸç  å°ç£ä½³å‘³">
      </div>
      <div class="cfg-row">
        <label>å‰¯æ¨™é¡Œï¼ˆå°é¢åˆ†éš”ç·šä¸­ï¼‰</label>
        <input type="text" id="cfg-subtitle" value="æ±‚å¥½é‹ Â· å•å¤©æ©Ÿ">
      </div>
      <div class="cfg-row">
        <label>å°é¢æŒ‰éˆ•æ–‡å­—</label>
        <input type="text" id="cfg-btn" value="æ–ä¸€æ–æ±‚ç±¤">
      </div>
      <div class="cfg-row">
        <label>æ–ç±¤é æ¨™é¡Œ</label>
        <input type="text" id="cfg-game-title" value="âœ¦ çœŸç å¥½é‹ç±¤ âœ¦">
      </div>
      <div class="cfg-row">
        <label>æ–ç±¤æç¤ºèª</label>
        <input type="text" id="cfg-shake-tip" value="é»˜å¿µå¿ƒä¸­é¡˜æœ›">
      </div>
      <div class="cfg-row">
        <label>çµæœé æ¨™é¡Œ</label>
        <input type="text" id="cfg-result-title" value="çœŸç å¥½é‹ç±¤">
      </div>
    </div>

    <div class="cfg-section">
      <h3>é¡è‰²ä¸»é¡Œ</h3>
      <div class="cfg-row" style="display:flex;gap:12px;flex-wrap:wrap;">
        <div style="flex:1;min-width:100px;">
          <label>ä¸»è‰²ï¼ˆç¿¡ç¿ ç¶ ï¼‰</label>
          <input type="color" id="cfg-jade" value="#4a8c7f">
        </div>
        <div style="flex:1;min-width:100px;">
          <label>æ·±ä¸»è‰²</label>
          <input type="color" id="cfg-jade-deep" value="#2d6b5e">
        </div>
        <div style="flex:1;min-width:100px;">
          <label>æ·ºä¸»è‰²</label>
          <input type="color" id="cfg-jade-light" value="#7bbcad">
        </div>
        <div style="flex:1;min-width:100px;">
          <label>èƒŒæ™¯å¥¶ç™½</label>
          <input type="color" id="cfg-cream" value="#f5f0e8">
        </div>
      </div>
    </div>

    <div class="cfg-section">
      <h3>ç±¤è©©ç®¡ç†</h3>
      <button class="cfg-apply" style="margin-bottom:10px;padding:10px;" onclick="addFortune()">ï¼‹ æ–°å¢ä¸€æ”¯ç±¤</button>
      <div id="fortuneList"></div>
    </div>

    <button class="cfg-apply" onclick="applyAll()">âœ… å¥—ç”¨æ‰€æœ‰è¨­å®š</button>
    <br><br>
    <button class="cfg-apply" style="background:transparent;border:1.5px solid #ccc;color:#999;" onclick="exportCfg()">ğŸ“¤ åŒ¯å‡ºè¨­å®š JSON</button>
  </div>
</div>

<script>
// ===== ç±¤è©©è³‡æ–™åº« =====
var fortunes = [
  {
    num:"ç¬¬ä¸€ç±¤", level:"great", badge:"å¤§å‰",
    poem:["å¥½é‹é€£é€£æ˜¥æ„æ¿ƒ","ä½³é¤šç¾å‘³æ—¥æ—¥è±","çœŸç å°å‘³è¿ç¦è‡³","è¬äº‹å¦‚æ„å–œæ°£ç›ˆ"],
    sections:[
      {label:"ç¸½è«–",text:"æ­¤ç±¤å¤§å‰ï¼Œå¥½é‹æ»¿æº¢ï¼Œè«¸äº‹é †é‚ï¼Œè²¡æºå»£é€²ã€‚"},
      {label:"äº‹æ¥­",text:"å·¥ä½œè¡¨ç¾äº®çœ¼ï¼Œè²´äººç›¸åŠ©ï¼Œå‡é·å¯æœŸï¼Œå¤§å±•èº«æ‰‹ã€‚"},
      {label:"æ„›æƒ…",text:"æ„Ÿæƒ…ç”œèœœç¾æ»¿ï¼Œæœ‰æƒ…äººçµ‚æˆçœ·å±¬ï¼Œçæƒœç·£åˆ†ã€‚"},
      {label:"è²¡é‹",text:"è²¡é‹äº¨é€šï¼ŒæŠ•è³‡æœ‰åˆ©ï¼ŒæŠŠæ¡æ©Ÿæœƒå¯æœ‰æ„å¤–ä¹‹è²¡ã€‚"},
      {label:"é£²é£Ÿ",text:"æ­¤ç±¤é©åˆå¤§é­šå¤§è‚‰æ…¶ç¥ï¼Œèˆ‡è¦ªå‹å…±äº«ç¾é£Ÿä½³é¤šã€‚"}
    ]
  },
  {
    num:"ç¬¬äºŒç±¤", level:"great", badge:"ä¸Šå‰",
    poem:["å±±çæµ·å‘³å…¥å£ç”˜","å®¶äººå…±èšè©±ç¬‘è«‡","å››å­£å¹³å®‰ç¦å£½é•·","ä¾†å¹´æ›´å‹å¾€å¹´é–“"],
    sections:[
      {label:"ç¸½è«–",text:"å®¶åº­å’Œæ¨‚ï¼Œè¦ªæƒ…æº«æš–ï¼Œèˆ‡æ‰€æ„›ä¹‹äººå…±åº¦å¥½æ™‚å…‰ã€‚"},
      {label:"äº‹æ¥­",text:"ç©©å®šæˆé•·ï¼Œæ­¥æ­¥ç‚ºç‡Ÿï¼Œå¿ èª å¾…äº‹å¿…æœ‰å›å ±ã€‚"},
      {label:"æ„›æƒ…",text:"å®¶åº­å’Œç¦ï¼Œå©šå§»ç¾æ»¿ï¼Œé‡è¦–å®¶äººæ˜¯æœ€å¥½çš„ç·£åˆ†ã€‚"},
      {label:"è²¡é‹",text:"ç©©ä¸­æœ‰å¢ï¼Œé©åˆä¿å®ˆæŠ•è³‡ï¼Œä¸å‹•ç”¢æœ‰åˆ©ã€‚"},
      {label:"é£²é£Ÿ",text:"é©åˆèˆ‡å®¶äººåœæ¡Œå…±é£Ÿï¼Œå°¤å…¶åœ“æ¡Œè½‰ç›¤å°èœæœ€ç‚ºå‰åˆ©ã€‚"}
    ]
  },
  {
    num:"ç¬¬ä¸‰ç±¤", level:"good", badge:"ä¸­å‰",
    poem:["éœæ°´æµæ·±è‡ªæœ‰æº","å®ˆå¾—é›²é–‹æœˆæ›´åœ“","è¬äº‹è¬€å®šè€Œå¾Œå‹•","æ˜¥æš–èŠ±é–‹åœ¨çœ¼å‰"],
    sections:[
      {label:"ç¸½è«–",text:"æ™‚æ©Ÿæ¼¸ç†Ÿï¼Œéœå¿ƒç­‰å¾…ï¼Œæ©Ÿæœƒå°‡è‡³ï¼Œä¸å®œæ“ä¹‹éæ€¥ã€‚"},
      {label:"äº‹æ¥­",text:"ç›®å‰å®œç©©ç´®ç©©æ‰“ï¼Œè¨ˆåŠƒå‘¨å…¨å¾Œå†å‡ºæ‰‹ï¼Œå¯ç²ä½³ç¸¾ã€‚"},
      {label:"æ„›æƒ…",text:"æ„Ÿæƒ…éœ€è¦è€å¿ƒçŒæº‰ï¼Œçµ¦å°æ–¹å’Œè‡ªå·±å¤šä¸€äº›æ™‚é–“ã€‚"},
      {label:"è²¡é‹",text:"è²¡é‹å¹³ç©©ä¸Šæšï¼Œè¬¹æ…è¦åŠƒï¼Œé¿å…è¡å‹•æ¶ˆè²»ã€‚"},
      {label:"é£²é£Ÿ",text:"æ¸…æ·¡é¤Šèº«ç‚ºå®œï¼Œå°èœæ¸…è’¸æ–™ç†æœ€åˆæ­¤æ™‚ç¯€æ°£ã€‚"}
    ]
  },
  {
    num:"ç¬¬å››ç±¤", level:"great", badge:"ç¦ç¥¿",
    poem:["é´»ç¦é½Šå¤©å–œäº‹å¤š","ä½³äººå…±åè©±å®¶å¸¸","ç ç‰æ»¿å ‚æ·»å–œè‰²","å¹³å®‰æ˜¯ç¦å‹é»ƒé‡‘"],
    sections:[
      {label:"ç¸½è«–",text:"ç¦ç¥¿é›™å…¨ï¼Œå®¶æ¥­èˆˆæ—ºï¼Œå–œäº‹é€£é€£ï¼Œæ˜¯éå¸¸å‰ç¥¥çš„ä¸€æ”¯ç±¤ã€‚"},
      {label:"äº‹æ¥­",text:"åˆä½œäº‹æ¥­å¤§å‰ï¼Œé©åˆèˆ‡ä»–äººæ”œæ‰‹ï¼Œé›™è´å±€é¢å¯æœŸã€‚"},
      {label:"æ„›æƒ…",text:"æƒ…ç·£æ·±åšï¼Œè‹¥æœ‰å©šå«ä¹‹æ„å¯ç©æ¥µé€²è¡Œã€‚"},
      {label:"è²¡é‹",text:"è²¡æºå»£é€²ï¼Œæœ‰æœ›æ‹“å±•äº‹æ¥­ç‰ˆåœ–ï¼ŒæŠ•è³‡æœ‰åˆ©ã€‚"},
      {label:"é£²é£Ÿ",text:"é©åˆè¨­å®´æ¬¾å¾…ã€å®¶æ—èšé¤ï¼ŒçœŸç å°èœæœ€åˆæ­¤å‰æ…¶æ°›åœã€‚"}
    ]
  },
  {
    num:"ç¬¬äº”ç±¤", level:"ok", badge:"å¹³å®‰",
    poem:["å¹³å¹³å®‰å®‰æ˜¯æœ€çœŸ","æŸ´ç±³æ²¹é¹½æœ‰é¤˜å­˜","çŸ¥è¶³å¸¸æ¨‚å¿ƒè‡ªåœ¨","ä¸€ç²¥ä¸€é£¯çš†æ˜¯æ©"],
    sections:[
      {label:"ç¸½è«–",text:"å¹³å®‰ç„¡äº‹å³æ˜¯ç¦ï¼ŒçŸ¥è¶³å¸¸æ¨‚ï¼Œè¸å¯¦ç”Ÿæ´»ã€‚"},
      {label:"äº‹æ¥­",text:"ç¾æ³ç©©å®šï¼Œä¸æ±‚å¤§èºé€²ï¼Œä½†æ±‚ç´®å¯¦é€²æ­¥ã€‚"},
      {label:"æ„›æƒ…",text:"æ„Ÿæƒ…å¹³é †ï¼Œäº’ç›¸é«”è«’ï¼Œå¹³æ·¡ä¹‹ä¸­è¦‹çœŸæƒ…ã€‚"},
      {label:"è²¡é‹",text:"æ”¶æ”¯å¹³è¡¡ï¼Œé‡å…¥ç‚ºå‡ºï¼Œå„²è“„ç‚ºä¸Šç­–ã€‚"},
      {label:"é£²é£Ÿ",text:"ç°¡å–®å®¶å¸¸å°èœæœ€èƒ½æº«æš–äººå¿ƒï¼Œç²¥å“æ»·è‚‰é£¯çš†å®œã€‚"}
    ]
  }
];

var currentFortune = null;
var soundOn = true;
var shakeCount = 0;
var lastAccel = {x:0,y:0,z:0};
var shakeBlocked = false;
var tapCount = 0;
var tapTimer = null;
var audioCtx = null;

// ===== åˆå§‹åŒ– =====
window.addEventListener('load',function(){
  setTimeout(function(){
    var pre = document.getElementById('preloader');
    pre.style.opacity='0';
    setTimeout(function(){ pre.style.display='none'; },800);
  },1400);
  
  createPetals();
  initGyro();
  renderFortuneList();
  
  document.getElementById('soundBtn').addEventListener('click',function(){
    soundOn=!soundOn;
    this.textContent=soundOn?'ğŸ”Š':'ğŸ”‡';
  });

  // éš±è—ç†±å€ï¼šå¿«é€Ÿä¸‰æ“Šé–‹å•Ÿå®¢è£½åŒ–é¢æ¿
  var trigger = document.getElementById('hiddenTrigger');
  trigger.addEventListener('click',function(){
    tapCount++;
    if(tapTimer) clearTimeout(tapTimer);
    tapTimer = setTimeout(function(){ tapCount=0; },800);
    if(tapCount>=3){
      tapCount=0;
      openPanel();
    }
  });
});

// ===== èŠ±ç“£ç²’å­ =====
function createPetals(){
  var cover = document.getElementById('pageCover');
  var symbols = ['âœ¿','â€','âš˜','âœ¾','â'];
  for(var i=0;i<10;i++){
    var p = document.createElement('div');
    p.className='petal';
    p.textContent = symbols[i%symbols.length];
    p.style.left=(Math.random()*100)+'%';
    p.style.fontSize=(Math.random()*10+9)+'px';
    p.style.color='rgba(74,140,127,'+(Math.random()*0.35+0.1)+')';
    p.style.animationDuration=(Math.random()*12+10)+'s';
    p.style.animationDelay=(Math.random()*10)+'s';
    cover.appendChild(p);
  }
}

// ===== é™€èºå„€ =====
function initGyro(){
  if(typeof DeviceOrientationEvent!=='undefined' && typeof DeviceOrientationEvent.requestPermission==='function'){
    document.getElementById('permDialog').classList.add('show');
  } else if(window.DeviceMotionEvent){
    window.addEventListener('devicemotion',handleMotion,false);
  }
  // è¦–å·®
  window.addEventListener('deviceorientation',handleOrientation,false);
}
function requestPerm(){
  document.getElementById('permDialog').classList.remove('show');
  DeviceMotionEvent.requestPermission().then(function(s){
    if(s==='granted'){
      window.addEventListener('devicemotion',handleMotion,false);
      window.addEventListener('deviceorientation',handleOrientation,false);
    }
  }).catch(function(){});
}
function handleMotion(e){
  if(!document.getElementById('pageGame').classList.contains('active')) return;
  if(shakeBlocked) return;
  var a = e.accelerationIncludingGravity;
  if(!a) return;
  var d=Math.abs(a.x-lastAccel.x)+Math.abs(a.y-lastAccel.y)+Math.abs(a.z-lastAccel.z);
  lastAccel={x:a.x,y:a.y,z:a.z};
  if(d>14){
    shakeCount++;
    if(shakeCount>=2){ triggerShake(); shakeCount=0; shakeBlocked=true; }
  }
}
function handleOrientation(e){
  if(!document.getElementById('pageCover').classList.contains('active')) return;
  var gm=e.gamma||0, bt=e.beta||0;
  var mx=(gm/90)*18, my=(bt/90)*12;
  document.getElementById('lCircle').style.transform='translate(-50%,-50%) translate3d('+(mx*0.1)+'px,'+(my*0.1)+'px,0)';
  document.getElementById('lFlower').style.transform='translate(-50%,-58%) translate3d('+(mx*0.5)+'px,'+(my*0.4)+'px,0)';
  document.getElementById('lBase').style.transform='translate3d('+(mx*0.3)+'px,0,0)';
  document.getElementById('lLeft').style.transform='translate3d('+(mx*0.4)+'px,'+(my*0.3)+'px,0)';
  document.getElementById('lRight').style.transform='translate3d('+(mx*0.4)+'px,'+(my*0.3)+'px,0)';
}

// ===== é é¢åˆ‡æ› =====
function transition(cb){
  var o=document.getElementById('overlay');
  o.classList.add('in');
  setTimeout(function(){
    cb();
    o.classList.remove('in');
  },350);
}
function goToGame(){
  playNote(440,0.08);
  shakeBlocked=false; shakeCount=0;
  document.getElementById('shakeInstruction').classList.remove('hidden');
  document.getElementById('btnSeeResult').style.display='none';
  document.getElementById('tapHint').style.display='block';
  document.getElementById('shakeCan').classList.remove('shaking');
  document.getElementById('sticks').style.opacity='0';
  transition(function(){ showPage('pageGame'); });
}
function goToCover(){
  transition(function(){ showPage('pageCover'); });
}
function goToResult(){
  renderResult(currentFortune);
  transition(function(){ showPage('pageResult'); });
}
function showPage(id){
  document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
  document.getElementById(id).classList.add('active');
}

// ===== æ–ç±¤ =====
function doShake(){ triggerShake(); }
function triggerShake(){
  var can=document.getElementById('shakeCan');
  if(can.classList.contains('shaking')) return;
  playNote(330,0.12);
  document.getElementById('shakeInstruction').classList.add('hidden');
  can.classList.add('shaking');
  document.getElementById('sticks').style.opacity='1';
  currentFortune = fortunes[Math.floor(Math.random()*fortunes.length)];
  setTimeout(function(){
    can.classList.remove('shaking');
    document.getElementById('sticks').style.opacity='0';
    document.getElementById('tapHint').style.display='none';
    document.getElementById('btnSeeResult').style.display='block';
    playNote(528,0.08);
  },2100);
}

// ===== æ¸²æŸ“çµæœ =====
function renderResult(f){
  document.getElementById('cardNum').textContent=f.num;
  var badge=document.getElementById('cardBadge');
  badge.textContent=f.badge;
  badge.className='level-badge badge-'+f.level;
  document.getElementById('cardPoem').innerHTML=f.poem.map(function(l){ return '<p>'+l+'</p>'; }).join('');
  document.getElementById('cardSections').innerHTML=f.sections.map(function(s){
    return '<div class="card-section"><span class="section-tag">'+s.label+'</span><span class="section-body">'+s.text+'</span></div>';
  }).join('');
}

// ===== éŸ³æ•ˆ =====
function playNote(freq,vol){
  if(!soundOn) return;
  try{
    if(!audioCtx) audioCtx=new(window.AudioContext||window.webkitAudioContext)();
    var o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.connect(g); g.connect(audioCtx.destination);
    o.frequency.value=freq; o.type='sine';
    g.gain.setValueAtTime(vol,audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.6);
    o.start(); o.stop(audioCtx.currentTime+0.6);
  }catch(e){}
}

// ===== å®¢è£½åŒ–é¢æ¿ =====
function openPanel(){ document.getElementById('customPanel').classList.add('open'); }
function closePanel(){ document.getElementById('customPanel').classList.remove('open'); }

function applyAll(){
  // æ–‡å­—
  document.getElementById('coverTitle').textContent = document.getElementById('cfg-title').value;
  document.getElementById('page-title').textContent = document.getElementById('cfg-title').value + ' âœ¦ æ±‚å¥½é‹';
  document.getElementById('coverSubtitle').textContent = document.getElementById('cfg-subtitle').value;
  document.getElementById('btnEnterText').textContent = document.getElementById('cfg-btn').value;
  document.getElementById('gameTitle').textContent = document.getElementById('cfg-game-title').value;
  document.getElementById('shakeTipText').textContent = document.getElementById('cfg-shake-tip').value;
  document.getElementById('resultTitle').textContent = document.getElementById('cfg-result-title').value;
  
  // é¡è‰²
  var jade = document.getElementById('cfg-jade').value;
  var jadeDeep = document.getElementById('cfg-jade-deep').value;
  var jadeLight = document.getElementById('cfg-jade-light').value;
  var cream = document.getElementById('cfg-cream').value;
  
  document.documentElement.style.setProperty('--jade', jade);
  document.documentElement.style.setProperty('--jade-deep', jadeDeep);
  document.documentElement.style.setProperty('--jade-light', jadeLight);
  document.documentElement.style.setProperty('--jade-pale', hexToRgba(jadeLight, 0.35));
  document.documentElement.style.setProperty('--cream', cream);
  document.documentElement.style.setProperty('--warm-white', mixColor(cream, '#ffffff', 0.5));
  
  closePanel();
  
  // å°æç¤ºå‹•ç•«
  var hint=document.createElement('div');
  hint.style.cssText='position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:var(--jade);color:#fff;padding:10px 24px;border-radius:30px;font-size:0.85rem;letter-spacing:0.2em;z-index:9999;transition:opacity 0.5s;font-family:var(--font-sans);';
  hint.textContent='è¨­å®šå·²å¥—ç”¨ âœ“';
  document.body.appendChild(hint);
  setTimeout(function(){ hint.style.opacity='0'; setTimeout(function(){ hint.remove(); },500); },1500);
}

function hexToRgba(hex,a){
  var r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
  return 'rgba('+r+','+g+','+b+','+a+')';
}
function mixColor(hex1,hex2,ratio){
  var r1=parseInt(hex1.slice(1,3),16),g1=parseInt(hex1.slice(3,5),16),b1=parseInt(hex1.slice(5,7),16);
  var r2=parseInt(hex2.slice(1,3),16),g2=parseInt(hex2.slice(3,5),16),b2=parseInt(hex2.slice(5,7),16);
  var r=Math.round(r1+(r2-r1)*ratio),g=Math.round(g1+(g2-g1)*ratio),b=Math.round(b1+(b2-b1)*ratio);
  return '#'+[r,g,b].map(function(v){ return Math.max(0,Math.min(255,v)).toString(16).padStart(2,'0'); }).join('');
}

// ===== ç±¤è©©ç®¡ç† =====
function renderFortuneList(){
  var list=document.getElementById('fortuneList');
  list.innerHTML='';
  fortunes.forEach(function(f,i){
    var d=document.createElement('div');
    d.className='fortune-item';
    d.innerHTML=
      '<div class="fortune-item-head">'+
        '<span>'+f.num+' Â· '+f.badge+'</span>'+
        '<button onclick="removeFortune('+i+')">âœ•</button>'+
      '</div>'+
      '<div class="cfg-row"><label>ç±¤å</label><input type="text" value="'+f.num+'" onchange="fortunes['+i+'].num=this.value"></div>'+
      '<div class="cfg-row"><label>ç‰ŒåŒ¾æ–‡å­—</label><input type="text" value="'+f.badge+'" onchange="fortunes['+i+'].badge=this.value"></div>'+
      '<div class="cfg-row"><label>ç­‰ç´š</label>'+
        '<select onchange="fortunes['+i+'].level=this.value">'+
          ['great','good','ok','bad'].map(function(l){ return '<option value="'+l+'"'+(f.level==l?' selected':'')+'>'+l+'</option>'; }).join('')+
        '</select>'+
      '</div>'+
      '<div class="cfg-row"><label>ç±¤è©©ï¼ˆæ¯è¡Œä¸€å¥ï¼‰</label>'+
        '<textarea onchange="fortunes['+i+'].poem=this.value.split(\'\\n\').slice(0,4)">'+f.poem.join('\n')+'</textarea>'+
      '</div>';
    list.appendChild(d);
  });
}
function addFortune(){
  fortunes.push({
    num:'ç¬¬'+(fortunes.length+1)+'ç±¤', level:'good', badge:'å‰',
    poem:['ç¬¬ä¸€å¥ç±¤è©©','ç¬¬äºŒå¥ç±¤è©©','ç¬¬ä¸‰å¥ç±¤è©©','ç¬¬å››å¥ç±¤è©©'],
    sections:[{label:'ç¸½è«–',text:'åœ¨æ­¤è¼¸å…¥è§£èªªæ–‡å­—ã€‚'},{label:'äº‹æ¥­',text:'åœ¨æ­¤è¼¸å…¥äº‹æ¥­é‹å‹¢ã€‚'}]
  });
  renderFortuneList();
}
function removeFortune(i){
  if(fortunes.length<=1){ alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€æ”¯ç±¤ï¼'); return; }
  fortunes.splice(i,1);
  renderFortuneList();
}
function exportCfg(){
  var cfg={
    title:document.getElementById('cfg-title').value,
    subtitle:document.getElementById('cfg-subtitle').value,
    fortunes:fortunes
  };
  var a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([JSON.stringify(cfg,null,2)],{type:'application/json'}));
  a.download='jinzhu-fortune-config.json';
  a.click();
}
function saveImg(){ alert('è«‹é•·æŒ‰ç•«é¢æˆªåœ–å„²å­˜æ‚¨çš„ç±¤è©©çµæœã€‚'); }
</script>
</body>
</html>
