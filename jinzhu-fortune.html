<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title id="page-title">çœŸç  å°ç£ä½³å‘³ âœ¦ æ±‚å¥½é‹</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700;900&family=Noto+Sans+TC:wght@300;400;500&display=swap');

:root {
  --jade:       #4a8c7f;
  --jade-deep:  #2d6b5e;
  --jade-light: #7bbcad;
  --jade-pale:  #c8e6e0;
  --cream:      #f5f0e8;
  --warm-white: #fdf9f4;
  --text-dark:  #2c2416;
  --text-mid:   #5a4a32;
  --text-light: #9a8870;
  --font-serif: 'Noto Serif TC', 'Times New Roman', serif;
  --font-sans:  'Noto Sans TC', sans-serif;
}

*{ box-sizing:border-box; margin:0; padding:0; -webkit-tap-highlight-color:transparent; touch-action:manipulation; }
html,body{ width:100%; height:100%; overflow:hidden; font-family:var(--font-sans); background:var(--cream); }

.page{ position:fixed; top:0; left:0; width:100%; height:100%; display:none; overflow:hidden; }
.page.active{ display:block; }

/* ===== PRELOADER ===== */
#preloader{
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:var(--warm-white);
  display:flex; align-items:center; justify-content:center; flex-direction:column;
  z-index:9999; transition:opacity 0.8s;
}
.pre-logo{ animation:logoBreath 1.6s ease-in-out infinite; }
.pre-text{ margin-top:14px; font-family:var(--font-serif); font-size:0.82rem; color:var(--jade); letter-spacing:0.5em; }
@keyframes logoBreath{ 0%,100%{transform:scale(1);opacity:0.85;} 50%{transform:scale(1.1);opacity:1;} }

/* ===== OVERLAY ===== */
.overlay{ position:fixed; top:0; left:0; width:100%; height:100%; background:var(--warm-white); z-index:5000; pointer-events:none; opacity:0; transition:opacity 0.3s; }
.overlay.in{ opacity:1; pointer-events:all; }

/* ===== SOUND ===== */
#soundBtn{
  position:fixed; top:14px; right:14px; width:36px; height:36px;
  background:rgba(255,255,255,0.88); border:1px solid var(--jade-pale);
  border-radius:50%; display:flex; align-items:center; justify-content:center;
  cursor:pointer; z-index:300; font-size:1rem;
}

/* ===== èŠ±ç£šæ ¼ç·š ===== */
.tile-bg{
  position:absolute; top:0; left:0; width:100%; height:100%;
  background-image:
    repeating-linear-gradient(0deg,  rgba(74,140,127,0.055) 0px, transparent 1px, transparent 39px, rgba(74,140,127,0.055) 40px),
    repeating-linear-gradient(90deg, rgba(74,140,127,0.055) 0px, transparent 1px, transparent 39px, rgba(74,140,127,0.055) 40px);
  pointer-events:none;
}

/* ===== COVER ===== */
#pageCover{ background:var(--warm-white); }

.parallax-wrap{ position:absolute; top:0; left:0; width:100%; height:100%; overflow:hidden; }
.layer{ position:absolute; will-change:transform; transition:transform 0.22s ease-out; }
.layer-circle{ top:50%; left:50%; transform:translate(-50%,-50%); width:min(82vw,370px); height:min(82vw,370px); }
.layer-flower{ top:50%; left:50%; transform:translate(-50%,-56%); width:min(52vw,228px); animation:gentleFloat 5s ease-in-out infinite; }
@keyframes gentleFloat{ 0%,100%{margin-top:0;} 50%{margin-top:-10px;} }
.layer-left{ top:28%; left:-3%; width:min(16vw,70px); }
.layer-right{ top:33%; right:-3%; width:min(16vw,70px); }

.cover-header{ position:absolute; top:6%; left:0; right:0; text-align:center; z-index:10; }
.jinzhu-logo-wrap{ display:inline-flex; flex-direction:column; align-items:center; gap:8px; }
.jinzhu-logo-svg{ width:min(18vw,74px); height:auto; filter:drop-shadow(0 3px 8px rgba(45,107,94,0.22)); }
.cover-title-text{ font-family:var(--font-serif); font-size:clamp(1.8rem,8vw,2.8rem); font-weight:900; color:var(--jade-deep); letter-spacing:0.2em; line-height:1; }
.cover-en-text{ font-family:var(--font-sans); font-size:clamp(0.6rem,2.5vw,0.78rem); font-weight:300; color:var(--jade); letter-spacing:0.7em; margin-top:2px; }
.cover-divider{ display:flex; align-items:center; justify-content:center; gap:10px; margin-top:10px; }
.cover-divider span{ height:1px; width:28px; background:linear-gradient(90deg,transparent,var(--jade-light),transparent); }
.cover-divider em{ font-style:normal; color:var(--jade); font-size:0.72rem; letter-spacing:0.25em; }

.btn-enter-wrap{ position:absolute; bottom:9%; left:50%; transform:translateX(-50%); z-index:10; cursor:pointer; }
.btn-enter-jinzhu{
  background:var(--jade); color:var(--warm-white);
  font-family:var(--font-serif); font-size:clamp(0.95rem,4.2vw,1.15rem);
  font-weight:600; letter-spacing:0.4em; padding:14px 42px;
  border-radius:60px; border:none;
  box-shadow:0 6px 24px rgba(74,140,127,0.38), inset 0 1px 0 rgba(255,255,255,0.18);
  transition:all 0.18s; white-space:nowrap;
}
.btn-enter-wrap:active .btn-enter-jinzhu{ transform:scale(0.96); }

/* èŠ±ç“£ */
.petal{ position:absolute; pointer-events:none; animation:petalDrift linear infinite; z-index:3; }
@keyframes petalDrift{
  0%{ transform:translateY(-30px) rotate(0deg) scale(0); opacity:0; }
  5%{ opacity:1; transform:translateY(0) rotate(20deg) scale(1); }
  95%{ opacity:0.2; }
  100%{ transform:translateY(108vh) rotate(600deg) scale(0.4); opacity:0; }
}

/* é™€èºå„€å½ˆçª— */
.perm-dialog{ position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(44,36,22,0.45); backdrop-filter:blur(4px); display:none; align-items:center; justify-content:center; z-index:1000; }
.perm-dialog.show{ display:flex; }
.perm-box{ background:var(--warm-white); border-radius:16px; padding:30px 26px; max-width:290px; text-align:center; box-shadow:0 16px 50px rgba(44,36,22,0.18); }
.perm-box h3{ font-family:var(--font-serif); color:var(--jade-deep); font-size:1.05rem; margin-bottom:8px; }
.perm-box p{ color:var(--text-mid); font-size:0.86rem; line-height:1.8; margin-bottom:18px; }
.perm-box button{ background:var(--jade); color:var(--warm-white); font-family:var(--font-serif); font-size:0.95rem; font-weight:600; letter-spacing:0.2em; padding:11px 30px; border-radius:60px; border:none; cursor:pointer; }

/* ===== GAME PAGE ===== */
#pageGame{ background:linear-gradient(160deg,var(--warm-white) 0%,var(--cream) 100%); }
.game-wrap{ position:relative; width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; }

.game-logo-area{ position:absolute; top:5%; left:0; right:0; display:flex; flex-direction:column; align-items:center; gap:6px; }
.game-logo-svg{ width:min(9vw,40px); height:auto; }
.game-title{ font-family:var(--font-serif); font-size:clamp(1rem,4.5vw,1.35rem); color:var(--jade-deep); letter-spacing:0.2em; font-weight:700; }

.shake-instruction{ position:absolute; top:20%; left:0; right:0; text-align:center; transition:opacity 0.5s,transform 0.5s; }
.shake-instruction.hidden{ opacity:0; transform:translateY(-8px); pointer-events:none; }
.shake-instruction p{ font-family:var(--font-serif); font-size:clamp(0.88rem,3.8vw,1.1rem); color:var(--text-mid); line-height:2.2; letter-spacing:0.1em; }
.shake-instruction p em{ font-style:normal; color:var(--jade); font-weight:700; }

.shake-can{ width:min(40vw,160px); height:min(50vw,200px); cursor:pointer; transition:transform 0.1s; }
.shake-can.shaking{ animation:canShake 2s cubic-bezier(0.36,0.07,0.19,0.97); }
@keyframes canShake{
  0%{transform:rotate(0);}5%{transform:rotate(-20deg) translateX(-5px);}10%{transform:rotate(20deg) translateX(5px);}
  15%{transform:rotate(-24deg) translateX(-7px);}20%{transform:rotate(24deg) translateX(7px);}
  25%{transform:rotate(-20deg) translateX(-5px);}30%{transform:rotate(20deg) translateX(5px);}
  35%{transform:rotate(-20deg) translateX(-6px);}40%{transform:rotate(20deg) translateX(6px);}
  48%{transform:rotate(-10deg) translateX(-3px);}55%{transform:rotate(10deg) translateX(3px);}
  65%{transform:rotate(-5deg) translateX(-1px);}80%{transform:rotate(3deg);}100%{transform:rotate(0);}
}

.tap-hint{ text-align:center; margin-top:14px; font-size:clamp(0.72rem,2.8vw,0.88rem); color:var(--text-light); letter-spacing:0.2em; animation:blink 2.5s ease-in-out infinite; }
@keyframes blink{ 0%,100%{opacity:0.3;} 50%{opacity:0.88;} }

/* ===== ç±¤ç«¹é£›å‡º overlay ===== */
#stickOverlay{
  position:fixed; top:0; left:0; width:100%; height:100%;
  pointer-events:none; z-index:4500; overflow:hidden; display:none;
}
#stickOverlay.active{ display:block; }

.flying-stick{
  position:absolute;
  bottom:42%;
  font-family:var(--font-serif);
  font-weight:900;
  writing-mode:vertical-rl;
  text-orientation:mixed;
  background:linear-gradient(180deg,#fffbee,#f5e8c0);
  border:2px solid rgba(74,140,127,0.55);
  border-radius:6px 6px 4px 4px;
  padding:10px 7px 14px;
  box-shadow:3px 3px 12px rgba(0,0,0,0.22), inset 0 1px 0 rgba(255,255,255,0.6);
  letter-spacing:0.18em;
  line-height:1.9;
  color:var(--jade-deep);
  font-size:clamp(16px,4.5vw,24px);
  opacity:0;
  animation:stickFly var(--dur,1.1s) cubic-bezier(0.22,0.61,0.36,1) var(--delay,0s) forwards;
}
@keyframes stickFly{
  0%  { opacity:0;   transform:translateY(20px) rotate(var(--r0)) scale(0.3); }
  12% { opacity:1;   transform:translateY(var(--y1)) rotate(var(--r1)) scale(1.08); }
  55% { opacity:1;   transform:translateY(var(--y2)) rotate(var(--r2)) scale(1); }
  85% { opacity:0.95;transform:translateY(var(--y3)) rotate(var(--r3)) scale(0.98); }
  100%{ opacity:0;   transform:translateY(var(--y3)) rotate(var(--r3)) scale(0.95); }
}

/* ===== RESULT PAGE ===== */
#pageResult{ background:var(--warm-white); overflow-y:auto; -webkit-overflow-scrolling:touch; }
.result-wrap{ min-height:100%; display:flex; flex-direction:column; align-items:center; padding:30px 18px 40px; }

.result-logo-row{ display:flex; align-items:center; gap:10px; margin-bottom:14px; }
.result-logo-svg{ width:30px; height:auto; }
.result-logo-label{ font-family:var(--font-sans); font-size:0.7rem; color:var(--text-light); letter-spacing:0.4em; }

.result-deco{ width:100%; max-width:380px; text-align:center; margin-bottom:14px; }
.deco-line{ display:flex; align-items:center; justify-content:center; gap:10px; }
.deco-line span{ flex:1; height:1px; background:linear-gradient(90deg,transparent,var(--jade-light)); }
.deco-line span:last-child{ background:linear-gradient(90deg,var(--jade-light),transparent); }
.deco-line em{ font-style:normal; color:var(--jade); font-size:0.88rem; }
.result-main-title{ font-family:var(--font-serif); font-size:clamp(1.3rem,5.5vw,2rem); color:var(--jade-deep); font-weight:900; letter-spacing:0.25em; margin:8px 0; }

/* ç±¤å¡ */
.fortune-card{ width:100%; max-width:380px; background:var(--warm-white); border:1.5px solid var(--jade-pale); border-radius:16px; overflow:hidden; box-shadow:0 8px 36px rgba(74,140,127,0.13),0 2px 8px rgba(44,36,22,0.07); }
.card-top-band{ height:7px; background:linear-gradient(90deg,var(--jade-deep),var(--jade-light),var(--jade-deep)); }
.card-header{ padding:20px 22px 14px; text-align:center; background:linear-gradient(180deg,rgba(200,230,224,0.18) 0%,transparent 100%); border-bottom:1px solid var(--jade-pale); }
.card-num{ font-family:var(--font-serif); font-size:clamp(1.2rem,5vw,1.7rem); font-weight:900; color:var(--jade-deep); letter-spacing:0.2em; }
.card-level-row{ margin-top:8px; display:flex; align-items:center; justify-content:center; }
.level-badge{ display:inline-flex; align-items:center; padding:5px 20px; border-radius:30px; font-family:var(--font-serif); font-size:clamp(0.82rem,3.3vw,0.96rem); font-weight:700; letter-spacing:0.15em; }
.badge-great{ background:linear-gradient(135deg,#4a8c7f,#2d6b5e); color:#fdf9f4; }
.badge-good{  background:linear-gradient(135deg,#5a9e6a,#3a7a4a); color:#fdf9f4; }
.badge-ok{    background:linear-gradient(135deg,#8a7a5a,#6a5a3a); color:#fdf9f4; }
.badge-bad{   background:linear-gradient(135deg,#8a8a8a,#5a5a5a); color:#fdf9f4; }

/* ç±¤è©©é€è¡Œå‹•ç•« */
.card-poem{ padding:18px 22px; border-bottom:1px solid rgba(74,140,127,0.15); text-align:center; }
.poem-line{ font-family:var(--font-serif); font-size:clamp(0.95rem,3.8vw,1.08rem); color:var(--text-dark); line-height:2.4; letter-spacing:0.2em; opacity:0; transform:translateY(16px); animation:lineUp 0.45s ease forwards; }
@keyframes lineUp{ to{ opacity:1; transform:translateY(0); } }

.card-sections{ padding:14px 18px 18px; }
.card-section{ display:flex; align-items:flex-start; padding:9px 0; border-bottom:1px dashed rgba(74,140,127,0.18); opacity:0; transform:translateX(-10px); animation:slideIn 0.38s ease forwards; }
@keyframes slideIn{ to{ opacity:1; transform:translateX(0); } }
.card-section:last-child{ border-bottom:none; }
.section-tag{ flex:0 0 auto; background:rgba(74,140,127,0.1); border:1px solid rgba(74,140,127,0.3); color:var(--jade-deep); font-size:0.7rem; font-weight:600; padding:3px 10px; border-radius:20px; letter-spacing:0.1em; margin-right:10px; margin-top:3px; white-space:nowrap; }
.section-body{ color:var(--text-mid); font-size:clamp(0.8rem,3vw,0.9rem); line-height:1.9; letter-spacing:0.04em; }

.result-btns{ display:flex; gap:12px; margin-top:18px; width:100%; max-width:380px; }
.rbtn{ flex:1; padding:13px 10px; border-radius:60px; font-family:var(--font-serif); font-size:clamp(0.82rem,3.3vw,0.96rem); font-weight:600; letter-spacing:0.2em; cursor:pointer; transition:all 0.18s; border:none; }
.rbtn:active{ transform:scale(0.96); }
.rbtn-outline{ background:transparent; border:1.5px solid var(--jade) !important; color:var(--jade-deep); }
.rbtn-fill{ background:var(--jade); color:var(--warm-white); box-shadow:0 4px 16px rgba(74,140,127,0.3); }
.brand-footer{ margin-top:20px; text-align:center; color:var(--text-light); font-size:0.7rem; letter-spacing:0.3em; }

/* ===== éš±è—å®¢è£½åŒ–é¢æ¿ ===== */
#hiddenTrigger{ position:fixed; bottom:0; right:0; width:50px; height:50px; z-index:9990; cursor:default; }
#customPanel{
  position:fixed; bottom:-100%; left:0; right:0; max-height:82%;
  background:var(--warm-white); border-top:2px solid var(--jade); border-radius:20px 20px 0 0;
  z-index:9995; overflow-y:auto; -webkit-overflow-scrolling:touch;
  transition:bottom 0.4s cubic-bezier(0.34,1.2,0.64,1); padding-bottom:30px;
  box-shadow:0 -8px 40px rgba(74,140,127,0.2);
}
#customPanel.open{ bottom:0; }
.panel-handle{ display:flex; align-items:center; justify-content:space-between; padding:16px 20px 12px; border-bottom:1px solid var(--jade-pale); position:sticky; top:0; background:var(--warm-white); z-index:1; }
.panel-handle h2{ font-family:var(--font-serif); font-size:1rem; color:var(--jade-deep); letter-spacing:0.2em; }
.panel-close{ background:none; border:none; color:var(--text-light); font-size:1.4rem; cursor:pointer; }
.panel-body{ padding:16px 20px; }
.cfg-section{ margin-bottom:20px; }
.cfg-section h3{ font-size:0.73rem; font-weight:600; color:var(--jade); letter-spacing:0.3em; text-transform:uppercase; margin-bottom:10px; padding-bottom:5px; border-bottom:1px solid var(--jade-pale); }
.cfg-row{ margin-bottom:10px; }
.cfg-row label{ display:block; font-size:0.76rem; color:var(--text-light); margin-bottom:4px; }
.cfg-row input,.cfg-row textarea,.cfg-row select{ width:100%; border:1.5px solid var(--jade-pale); border-radius:8px; padding:8px 12px; color:var(--text-dark); font-family:var(--font-sans); font-size:0.84rem; outline:none; background:var(--warm-white); transition:border-color 0.2s; }
.cfg-row input:focus,.cfg-row textarea:focus{ border-color:var(--jade); }
.cfg-row textarea{ height:70px; resize:vertical; }
.cfg-row input[type="color"]{ height:36px; padding:2px 4px; cursor:pointer; }
.cfg-apply{ width:100%; background:var(--jade); color:var(--warm-white); font-family:var(--font-serif); font-size:0.95rem; font-weight:600; letter-spacing:0.3em; padding:13px; border-radius:60px; border:none; cursor:pointer; transition:all 0.18s; margin-top:4px; }
.cfg-apply:active{ transform:scale(0.98); }
.fortune-item{ border:1px solid var(--jade-pale); border-radius:10px; padding:12px; margin-bottom:10px; }
.fortune-item-head{ display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
.fortune-item-head span{ font-size:0.82rem; color:var(--jade-deep); font-weight:600; }
.fortune-item-head button{ background:none; border:none; color:rgba(192,57,43,0.6); cursor:pointer; font-size:1rem; }
</style>
</head>
<body>

<!-- é è¼‰ -->
<div id="preloader">
  <svg class="pre-logo" width="88" height="100" viewBox="0 0 100 114" xmlns="http://www.w3.org/2000/svg">
    <polygon points="50,4 92,27 92,73 50,96 8,73 8,27" fill="#2d6b5e"/>
    <polygon points="50,11 85,30 85,70 50,89 15,70 15,30" fill="#fdf9f4"/>
    <path d="M50,70 C50,70 26,53 26,38 A24,24,0,0,1,74,38 C74,53 50,70 50,70 Z" fill="#d9405e"/>
    <path d="M50,70 C50,70 31,55 31,42 A19,19,0,0,1,69,42 C69,55 50,70 50,70 Z" fill="#f06080"/>
    <line x1="50" y1="70" x2="32" y2="37" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
    <line x1="50" y1="70" x2="41" y2="32" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
    <line x1="50" y1="70" x2="50" y2="30" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
    <line x1="50" y1="70" x2="59" y2="32" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
    <line x1="50" y1="70" x2="68" y2="37" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
    <ellipse cx="50" cy="70" rx="15" ry="7.5" fill="#e0c090"/>
    <polygon points="50,4 92,27 92,73 50,96 8,73 8,27" fill="none" stroke="#4a8c7f" stroke-width="2.8"/>
    <text x="50" y="110" text-anchor="middle" font-size="9" fill="#2d6b5e" font-family="serif" font-weight="bold" letter-spacing="2">çœŸç </text>
  </svg>
  <div class="pre-text">çœŸ ç  Â· å° ç£ ä½³ å‘³</div>
</div>

<div class="overlay" id="overlay"></div>
<button id="soundBtn" title="éŸ³æ•ˆ">ğŸ”Š</button>
<div id="stickOverlay"></div>

<!-- ==================== COVER ==================== -->
<div class="page active" id="pageCover">
  <div class="tile-bg"></div>
  <div class="parallax-wrap">
    <div class="layer layer-circle" id="lCircle">
      <svg viewBox="0 0 370 370" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
        <circle cx="185" cy="185" r="178" fill="rgba(200,230,224,0.14)" stroke="rgba(74,140,127,0.18)" stroke-width="1.5"/>
        <circle cx="185" cy="185" r="152" fill="none" stroke="rgba(74,140,127,0.09)" stroke-width="1" stroke-dasharray="4 8"/>
        <circle cx="185" cy="185" r="124" fill="none" stroke="rgba(74,140,127,0.06)" stroke-width="1"/>
      </svg>
    </div>
    <div class="layer layer-flower" id="lFlower">
      <svg viewBox="0 0 220 238" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
        <line x1="110" y1="186" x2="110" y2="238" stroke="#4a8c7f" stroke-width="5" stroke-linecap="round"/>
        <path d="M110 214 Q75 184 58 154 Q90 167 110 198" fill="#5a9e6a" opacity="0.78"/>
        <path d="M110 214 Q145 184 162 154 Q130 167 110 198" fill="#5a9e6a" opacity="0.78"/>
        <ellipse cx="110" cy="88" rx="19" ry="36" fill="#7bbcad" opacity="0.68" transform="rotate(0,110,116)"/>
        <ellipse cx="110" cy="88" rx="19" ry="36" fill="#7bbcad" opacity="0.68" transform="rotate(40,110,116)"/>
        <ellipse cx="110" cy="88" rx="19" ry="36" fill="#7bbcad" opacity="0.68" transform="rotate(80,110,116)"/>
        <ellipse cx="110" cy="88" rx="19" ry="36" fill="#7bbcad" opacity="0.68" transform="rotate(120,110,116)"/>
        <ellipse cx="110" cy="88" rx="19" ry="36" fill="#7bbcad" opacity="0.68" transform="rotate(160,110,116)"/>
        <ellipse cx="110" cy="88" rx="19" ry="36" fill="#7bbcad" opacity="0.68" transform="rotate(200,110,116)"/>
        <ellipse cx="110" cy="88" rx="19" ry="36" fill="#7bbcad" opacity="0.68" transform="rotate(240,110,116)"/>
        <ellipse cx="110" cy="88" rx="19" ry="36" fill="#7bbcad" opacity="0.68" transform="rotate(280,110,116)"/>
        <ellipse cx="110" cy="88" rx="19" ry="36" fill="#7bbcad" opacity="0.68" transform="rotate(320,110,116)"/>
        <ellipse cx="110" cy="95" rx="13" ry="26" fill="#4a8c7f" opacity="0.9" transform="rotate(20,110,116)"/>
        <ellipse cx="110" cy="95" rx="13" ry="26" fill="#4a8c7f" opacity="0.9" transform="rotate(60,110,116)"/>
        <ellipse cx="110" cy="95" rx="13" ry="26" fill="#4a8c7f" opacity="0.9" transform="rotate(100,110,116)"/>
        <ellipse cx="110" cy="95" rx="13" ry="26" fill="#4a8c7f" opacity="0.9" transform="rotate(140,110,116)"/>
        <ellipse cx="110" cy="95" rx="13" ry="26" fill="#4a8c7f" opacity="0.9" transform="rotate(180,110,116)"/>
        <ellipse cx="110" cy="95" rx="13" ry="26" fill="#4a8c7f" opacity="0.9" transform="rotate(220,110,116)"/>
        <ellipse cx="110" cy="95" rx="13" ry="26" fill="#4a8c7f" opacity="0.9" transform="rotate(260,110,116)"/>
        <ellipse cx="110" cy="95" rx="13" ry="26" fill="#4a8c7f" opacity="0.9" transform="rotate(300,110,116)"/>
        <ellipse cx="110" cy="95" rx="13" ry="26" fill="#4a8c7f" opacity="0.9" transform="rotate(340,110,116)"/>
        <circle cx="110" cy="116" r="17" fill="#c8e6e0"/>
        <circle cx="110" cy="116" r="12" fill="#7bbcad"/>
        <circle cx="110" cy="116" r="7" fill="#4a8c7f"/>
        <circle cx="110" cy="110" r="2" fill="#c8e6e0"/><circle cx="116" cy="114" r="1.8" fill="#c8e6e0"/><circle cx="104" cy="114" r="1.8" fill="#c8e6e0"/><circle cx="113" cy="121" r="1.8" fill="#c8e6e0"/><circle cx="107" cy="121" r="1.8" fill="#c8e6e0"/>
      </svg>
    </div>
    <div class="layer layer-left" id="lLeft">
      <svg viewBox="0 0 80 200" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
        <line x1="40" y1="200" x2="40" y2="0" stroke="rgba(74,140,127,0.2)" stroke-width="8" stroke-linecap="round"/>
        <ellipse cx="40" cy="68" rx="6" ry="3" fill="rgba(74,140,127,0.26)"/><ellipse cx="40" cy="118" rx="6" ry="3" fill="rgba(74,140,127,0.26)"/><ellipse cx="40" cy="168" rx="6" ry="3" fill="rgba(74,140,127,0.26)"/>
        <path d="M40 78 Q10 58 5 28 Q30 48 40 73" fill="rgba(90,158,106,0.26)"/>
        <path d="M40 128 Q10 108 5 78 Q30 98 40 123" fill="rgba(90,158,106,0.2)"/>
      </svg>
    </div>
    <div class="layer layer-right" id="lRight">
      <svg viewBox="0 0 80 200" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
        <line x1="40" y1="200" x2="40" y2="0" stroke="rgba(74,140,127,0.2)" stroke-width="8" stroke-linecap="round"/>
        <ellipse cx="40" cy="68" rx="6" ry="3" fill="rgba(74,140,127,0.26)"/><ellipse cx="40" cy="118" rx="6" ry="3" fill="rgba(74,140,127,0.26)"/><ellipse cx="40" cy="168" rx="6" ry="3" fill="rgba(74,140,127,0.26)"/>
        <path d="M40 78 Q70 58 75 28 Q50 48 40 73" fill="rgba(90,158,106,0.26)"/>
        <path d="M40 128 Q70 108 75 78 Q50 98 40 123" fill="rgba(90,158,106,0.2)"/>
      </svg>
    </div>
    <div class="layer" id="lBase" style="position:absolute;bottom:0;left:0;width:100%;">
      <svg viewBox="0 0 400 155" width="100%" height="auto" preserveAspectRatio="xMidYMax meet" xmlns="http://www.w3.org/2000/svg">
        <rect x="0" y="135" width="400" height="20" fill="rgba(74,140,127,0.1)"/>
        <ellipse cx="200" cy="135" rx="220" ry="18" fill="rgba(74,140,127,0.07)"/>
        <ellipse cx="70" cy="136" rx="52" ry="13" fill="rgba(74,140,127,0.26)"/>
        <ellipse cx="200" cy="140" rx="68" ry="14" fill="rgba(74,140,127,0.2)"/>
        <ellipse cx="330" cy="135" rx="48" ry="12" fill="rgba(74,140,127,0.24)"/>
        <line x1="70" y1="134" x2="72" y2="86" stroke="rgba(74,140,127,0.32)" stroke-width="3"/>
        <line x1="200" y1="138" x2="200" y2="66" stroke="rgba(74,140,127,0.32)" stroke-width="4"/>
        <line x1="330" y1="133" x2="328" y2="90" stroke="rgba(74,140,127,0.32)" stroke-width="3"/>
        <ellipse cx="72" cy="76" rx="13" ry="18" fill="rgba(74,140,127,0.5)"/>
        <ellipse cx="328" cy="78" rx="14" ry="20" fill="rgba(74,140,127,0.5)"/>
      </svg>
    </div>
  </div>

  <!-- å°é¢ Logo + æ¨™é¡Œ -->
  <div class="cover-header">
    <div class="jinzhu-logo-wrap">
      <svg class="jinzhu-logo-svg" viewBox="0 0 100 114" xmlns="http://www.w3.org/2000/svg">
        <polygon points="50,4 92,27 92,73 50,96 8,73 8,27" fill="#2d6b5e"/>
        <polygon points="50,11 85,30 85,70 50,89 15,70 15,30" fill="#fdf9f4"/>
        <path d="M50,70 C50,70 26,53 26,38 A24,24,0,0,1,74,38 C74,53 50,70 50,70 Z" fill="#d9405e"/>
        <path d="M50,70 C50,70 31,55 31,42 A19,19,0,0,1,69,42 C69,55 50,70 50,70 Z" fill="#f06080"/>
        <line x1="50" y1="70" x2="32" y2="37" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
        <line x1="50" y1="70" x2="41" y2="32" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
        <line x1="50" y1="70" x2="50" y2="30" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
        <line x1="50" y1="70" x2="59" y2="32" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
        <line x1="50" y1="70" x2="68" y2="37" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
        <ellipse cx="50" cy="70" rx="15" ry="7.5" fill="#e0c090"/>
        <polygon points="50,4 92,27 92,73 50,96 8,73 8,27" fill="none" stroke="#4a8c7f" stroke-width="2.8"/>
        <text x="50" y="110" text-anchor="middle" font-size="9" fill="#2d6b5e" font-family="serif" font-weight="bold" letter-spacing="2">çœŸç </text>
      </svg>
      <div class="cover-title-text" id="coverTitle">çœŸç  å°ç£ä½³å‘³</div>
      <div class="cover-en-text">JIN Â· ZHU</div>
    </div>
    <div class="cover-divider">
      <span></span><em id="coverSubtitle">æ±‚å¥½é‹ Â· å•å¤©æ©Ÿ</em><span></span>
    </div>
  </div>

  <div class="btn-enter-wrap" onclick="goToGame()">
    <button class="btn-enter-jinzhu" id="btnEnterText">æ–ä¸€æ–æ±‚ç±¤</button>
  </div>

  <div class="perm-dialog" id="permDialog">
    <div class="perm-box">
      <h3>éœ€è¦é™€èºå„€æ¬Šé™</h3>
      <p>è«‹æˆæ¬Šä½¿ç”¨è¨­å‚™é™€èºå„€ï¼Œé«”é©—è¦–å·®å‹•æ…‹æ•ˆæœã€‚</p>
      <button onclick="requestPerm()">æˆ æ¬Š</button>
    </div>
  </div>
</div>

<!-- ==================== GAME ==================== -->
<div class="page" id="pageGame">
  <div class="tile-bg"></div>
  <div class="game-wrap">
    <div class="game-logo-area">
      <svg class="game-logo-svg" viewBox="0 0 100 114" xmlns="http://www.w3.org/2000/svg">
        <polygon points="50,4 92,27 92,73 50,96 8,73 8,27" fill="#2d6b5e"/>
        <polygon points="50,11 85,30 85,70 50,89 15,70 15,30" fill="#fdf9f4"/>
        <path d="M50,70 C50,70 26,53 26,38 A24,24,0,0,1,74,38 C74,53 50,70 50,70 Z" fill="#d9405e"/>
        <path d="M50,70 C50,70 31,55 31,42 A19,19,0,0,1,69,42 C69,55 50,70 50,70 Z" fill="#f06080"/>
        <line x1="50" y1="70" x2="50" y2="30" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
        <line x1="50" y1="70" x2="41" y2="32" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
        <line x1="50" y1="70" x2="59" y2="32" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
        <ellipse cx="50" cy="70" rx="15" ry="7.5" fill="#e0c090"/>
        <polygon points="50,4 92,27 92,73 50,96 8,73 8,27" fill="none" stroke="#4a8c7f" stroke-width="2.8"/>
      </svg>
      <div class="game-title" id="gameTitle">âœ¦ çœŸç å¥½é‹ç±¤ âœ¦</div>
    </div>
    <div class="shake-instruction" id="shakeInstruction">
      <p><em id="shakeTipText">é»˜å¿µå¿ƒä¸­é¡˜æœ›</em><br>æ–æ™ƒæ‰‹æ©Ÿ æˆ– é»æ“Šç±¤ç­’</p>
    </div>
    <!-- ç±¤ç­’ -->
    <div class="shake-can" id="shakeCan" onclick="doShake()">
      <svg viewBox="0 0 160 200" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%">
        <defs>
          <linearGradient id="cg1" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#2d6b5e"/><stop offset="38%" stop-color="#4a8c7f"/>
            <stop offset="62%" stop-color="#55a090"/><stop offset="100%" stop-color="#2d6b5e"/>
          </linearGradient>
          <linearGradient id="cg2" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" stop-color="#7bbcad"/><stop offset="100%" stop-color="#4a8c7f"/>
          </linearGradient>
        </defs>
        <g id="sticks" style="opacity:0;transition:opacity 0.25s;">
          <rect x="58" y="14" width="7" height="80" rx="3.5" fill="#b08040" transform="rotate(-16,61,54)"/>
          <rect x="70" y="8" width="7" height="86" rx="3.5" fill="#d4a050"/>
          <rect x="82" y="12" width="7" height="82" rx="3.5" fill="#b08040" transform="rotate(11,85,53)"/>
          <rect x="94" y="9" width="6" height="84" rx="3" fill="#c89040" transform="rotate(-7,97,51)"/>
        </g>
        <ellipse cx="80" cy="188" rx="36" ry="8" fill="#2d6b5e"/>
        <rect x="44" y="85" width="72" height="107" rx="8" fill="url(#cg1)"/>
        <rect x="42" y="79" width="76" height="16" rx="8" fill="url(#cg2)"/>
        <ellipse cx="80" cy="79" rx="38" ry="8" fill="url(#cg2)"/>
        <g opacity="0.3" fill="none" stroke="#c8e6e0" stroke-width="1">
          <rect x="54" y="97" width="15" height="15" rx="2"/><line x1="54" y1="104.5" x2="69" y2="104.5"/><line x1="61.5" y1="97" x2="61.5" y2="112"/>
          <rect x="91" y="97" width="15" height="15" rx="2"/><line x1="91" y1="104.5" x2="106" y2="104.5"/><line x1="98.5" y1="97" x2="98.5" y2="112"/>
          <rect x="54" y="152" width="15" height="15" rx="2"/><line x1="54" y1="159.5" x2="69" y2="159.5"/><line x1="61.5" y1="152" x2="61.5" y2="167"/>
          <rect x="91" y="152" width="15" height="15" rx="2"/><line x1="91" y1="159.5" x2="106" y2="159.5"/><line x1="98.5" y1="152" x2="98.5" y2="167"/>
        </g>
        <rect x="44" y="131" width="72" height="1.5" fill="rgba(200,160,74,0.45)"/>
        <text x="80" y="120" text-anchor="middle" font-size="14" fill="rgba(200,230,224,0.88)" font-family="serif" font-weight="bold" letter-spacing="2">æ±‚</text>
        <text x="80" y="148" text-anchor="middle" font-size="14" fill="rgba(200,230,224,0.88)" font-family="serif" font-weight="bold" letter-spacing="2">ç±¤</text>
        <text x="80" y="89" text-anchor="middle" font-size="8.5" fill="rgba(200,230,224,0.7)" font-family="sans-serif" letter-spacing="1">çœŸ ç </text>
      </svg>
    </div>
    <div class="tap-hint" id="tapHint">è¼•è§¸ç±¤ç­’ æˆ– æ–æ™ƒæ‰‹æ©Ÿ</div>
  </div>
</div>

<!-- ==================== RESULT ==================== -->
<div class="page" id="pageResult">
  <div class="result-wrap">
    <div class="result-logo-row">
      <svg class="result-logo-svg" viewBox="0 0 100 114" xmlns="http://www.w3.org/2000/svg">
        <polygon points="50,4 92,27 92,73 50,96 8,73 8,27" fill="#2d6b5e"/>
        <polygon points="50,11 85,30 85,70 50,89 15,70 15,30" fill="#fdf9f4"/>
        <path d="M50,70 C50,70 26,53 26,38 A24,24,0,0,1,74,38 C74,53 50,70 50,70 Z" fill="#d9405e"/>
        <path d="M50,70 C50,70 31,55 31,42 A19,19,0,0,1,69,42 C69,55 50,70 50,70 Z" fill="#f06080"/>
        <line x1="50" y1="70" x2="50" y2="30" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
        <line x1="50" y1="70" x2="41" y2="32" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
        <line x1="50" y1="70" x2="59" y2="32" stroke="rgba(255,255,255,0.45)" stroke-width="1.3"/>
        <ellipse cx="50" cy="70" rx="15" ry="7.5" fill="#e0c090"/>
        <polygon points="50,4 92,27 92,73 50,96 8,73 8,27" fill="none" stroke="#4a8c7f" stroke-width="2.8"/>
      </svg>
      <div class="result-logo-label">çœŸ ç  å° ç£ ä½³ å‘³</div>
    </div>
    <div class="result-deco">
      <div class="deco-line"><span></span><em>âœ¦</em><span></span></div>
      <div class="result-main-title" id="resultTitle">çœŸç å¥½é‹ç±¤</div>
      <div class="deco-line" style="margin-top:8px;"><span></span><em>âœ¦</em><span></span></div>
    </div>
    <div class="fortune-card" id="fortuneCard">
      <div class="card-top-band"></div>
      <div class="card-header">
        <div class="card-num" id="cardNum">ç¬¬ä¸€ç±¤</div>
        <div class="card-level-row"><span class="level-badge badge-great" id="cardBadge">å¤§å‰</span></div>
      </div>
      <div class="card-poem" id="cardPoem"></div>
      <div class="card-sections" id="cardSections"></div>
    </div>
    <div class="result-btns">
      <button class="rbtn rbtn-outline" onclick="goToCover()">å†æ±‚ä¸€ç±¤</button>
      <button class="rbtn rbtn-fill" onclick="saveImg()">å„²å­˜çµæœ</button>
    </div>
    <div class="brand-footer">çœŸç  å°ç£ä½³å‘³ Â· JIN-ZHU Â· å°ç£å¥½å‘³é“</div>
  </div>
</div>

<div id="hiddenTrigger"></div>

<!-- å®¢è£½åŒ–é¢æ¿ -->
<div id="customPanel">
  <div class="panel-handle">
    <h2>âš™ å®¢è£½åŒ–è¨­å®š</h2>
    <button class="panel-close" onclick="closePanel()">âœ•</button>
  </div>
  <div class="panel-body">
    <div class="cfg-section">
      <h3>åŸºæœ¬æ–‡å­—</h3>
      <div class="cfg-row"><label>å°é¢å¤§æ¨™é¡Œ</label><input type="text" id="cfg-title" value="çœŸç  å°ç£ä½³å‘³"></div>
      <div class="cfg-row"><label>å‰¯æ¨™é¡Œ</label><input type="text" id="cfg-subtitle" value="æ±‚å¥½é‹ Â· å•å¤©æ©Ÿ"></div>
      <div class="cfg-row"><label>å°é¢æŒ‰éˆ•</label><input type="text" id="cfg-btn" value="æ–ä¸€æ–æ±‚ç±¤"></div>
      <div class="cfg-row"><label>æ–ç±¤é æ¨™é¡Œ</label><input type="text" id="cfg-game-title" value="âœ¦ çœŸç å¥½é‹ç±¤ âœ¦"></div>
      <div class="cfg-row"><label>æ–ç±¤æç¤ºèª</label><input type="text" id="cfg-shake-tip" value="é»˜å¿µå¿ƒä¸­é¡˜æœ›"></div>
      <div class="cfg-row"><label>çµæœé æ¨™é¡Œ</label><input type="text" id="cfg-result-title" value="çœŸç å¥½é‹ç±¤"></div>
    </div>
    <div class="cfg-section">
      <h3>é¡è‰²ä¸»é¡Œ</h3>
      <div class="cfg-row" style="display:flex;gap:10px;flex-wrap:wrap;">
        <div style="flex:1;min-width:90px;"><label>ä¸»è‰²</label><input type="color" id="cfg-jade" value="#4a8c7f"></div>
        <div style="flex:1;min-width:90px;"><label>æ·±è‰²</label><input type="color" id="cfg-jade-deep" value="#2d6b5e"></div>
        <div style="flex:1;min-width:90px;"><label>æ·ºè‰²</label><input type="color" id="cfg-jade-light" value="#7bbcad"></div>
        <div style="flex:1;min-width:90px;"><label>èƒŒæ™¯è‰²</label><input type="color" id="cfg-cream" value="#f5f0e8"></div>
      </div>
    </div>
    <div class="cfg-section">
      <h3>ç±¤è©©ç®¡ç†</h3>
      <button class="cfg-apply" style="padding:10px;margin-bottom:10px;" onclick="addFortune()">ï¼‹ æ–°å¢ä¸€æ”¯ç±¤</button>
      <div id="fortuneList"></div>
    </div>
    <button class="cfg-apply" onclick="applyAll()">âœ… å¥—ç”¨æ‰€æœ‰è¨­å®š</button>
    <br><br>
    <button class="cfg-apply" style="background:transparent;border:1.5px solid #ccc;color:#999;" onclick="exportCfg()">ğŸ“¤ åŒ¯å‡ºè¨­å®š JSON</button>
  </div>
</div>

<script>
var fortunes = [
  { num:"ç¬¬ä¸€ç±¤", level:"great", badge:"å¤§å‰",
    poem:["å¥½é‹é€£é€£æ˜¥æ„æ¿ƒ","ä½³é¤šç¾å‘³æ—¥æ—¥è±","çœŸç å°å‘³è¿ç¦è‡³","è¬äº‹å¦‚æ„å–œæ°£ç›ˆ"],
    sections:[{label:"ç¸½è«–",text:"æ­¤ç±¤å¤§å‰ï¼Œå¥½é‹æ»¿æº¢ï¼Œè«¸äº‹é †é‚ï¼Œè²¡æºå»£é€²ã€‚"},{label:"äº‹æ¥­",text:"è²´äººç›¸åŠ©ï¼Œäº‹æ¥­è’¸è’¸æ—¥ä¸Šï¼Œå‡é·å¯æœŸã€‚"},{label:"æ„›æƒ…",text:"æ„Ÿæƒ…ç”œèœœç¾æ»¿ï¼Œçæƒœçœ¼å‰ç·£åˆ†ã€‚"},{label:"è²¡é‹",text:"è²¡é‹äº¨é€šï¼ŒæŠ•è³‡æœ‰åˆ©ï¼ŒæŠŠæ¡æ©Ÿæœƒã€‚"},{label:"é£²é£Ÿ",text:"é©åˆè¨­å®´æ…¶ç¥ï¼ŒçœŸç å°èœå…±äº«ä½³é¤šã€‚"}]
  },
  { num:"ç¬¬äºŒç±¤", level:"great", badge:"ä¸Šå‰",
    poem:["å±±çæµ·å‘³å…¥å£ç”˜","å®¶äººå…±èšè©±ç¬‘è«‡","å››å­£å¹³å®‰ç¦å£½é•·","ä¾†å¹´æ›´å‹å¾€å¹´é–“"],
    sections:[{label:"ç¸½è«–",text:"å®¶åº­å’Œæ¨‚ï¼Œè¦ªæƒ…æº«æš–ï¼Œèˆ‡æ‰€æ„›ä¹‹äººå…±åº¦å¥½æ™‚å…‰ã€‚"},{label:"äº‹æ¥­",text:"ç©©å®šæˆé•·ï¼Œæ­¥æ­¥ç‚ºç‡Ÿï¼Œå¿ èª å¾…äº‹å¿…æœ‰å›å ±ã€‚"},{label:"æ„›æƒ…",text:"å®¶åº­å’Œç¦ï¼Œå©šå§»ç¾æ»¿ã€‚"},{label:"è²¡é‹",text:"ç©©ä¸­æœ‰å¢ï¼Œé©åˆä¿å®ˆæŠ•è³‡ã€‚"},{label:"é£²é£Ÿ",text:"é©åˆèˆ‡å®¶äººåœæ¡Œå…±é£Ÿï¼Œåœ“æ¡Œå°èœæœ€ç‚ºå‰åˆ©ã€‚"}]
  },
  { num:"ç¬¬ä¸‰ç±¤", level:"good", badge:"ä¸­å‰",
    poem:["éœæ°´æµæ·±è‡ªæœ‰æº","å®ˆå¾—é›²é–‹æœˆæ›´åœ“","è¬äº‹è¬€å®šè€Œå¾Œå‹•","æ˜¥æš–èŠ±é–‹åœ¨çœ¼å‰"],
    sections:[{label:"ç¸½è«–",text:"æ™‚æ©Ÿæ¼¸ç†Ÿï¼Œéœå¿ƒç­‰å¾…ï¼Œä¸å®œæ“ä¹‹éæ€¥ã€‚"},{label:"äº‹æ¥­",text:"å®œç©©ç´®ç©©æ‰“ï¼Œè¨ˆåŠƒå‘¨å…¨å¾Œå†å‡ºæ‰‹ã€‚"},{label:"æ„›æƒ…",text:"æ„Ÿæƒ…éœ€è¦è€å¿ƒçŒæº‰ï¼Œçµ¦å½¼æ­¤å¤šä¸€äº›æ™‚é–“ã€‚"},{label:"è²¡é‹",text:"è²¡é‹å¹³ç©©ä¸Šæšï¼Œè¬¹æ…è¦åŠƒã€‚"},{label:"é£²é£Ÿ",text:"æ¸…æ·¡é¤Šèº«ï¼Œå°èœæ¸…è’¸æ–™ç†æœ€åˆæ™‚å®œã€‚"}]
  },
  { num:"ç¬¬å››ç±¤", level:"great", badge:"ç¦ç¥¿",
    poem:["é´»ç¦é½Šå¤©å–œäº‹å¤š","ä½³äººå…±åè©±å®¶å¸¸","ç ç‰æ»¿å ‚æ·»å–œè‰²","å¹³å®‰æ˜¯ç¦å‹é»ƒé‡‘"],
    sections:[{label:"ç¸½è«–",text:"ç¦ç¥¿é›™å…¨ï¼Œå®¶æ¥­èˆˆæ—ºï¼Œå–œäº‹é€£é€£ã€‚"},{label:"äº‹æ¥­",text:"åˆä½œäº‹æ¥­å¤§å‰ï¼Œé›™è´å±€é¢å¯æœŸã€‚"},{label:"æ„›æƒ…",text:"æƒ…ç·£æ·±åšï¼Œå¯ç©æ¥µé€²è¡Œå©šå«ã€‚"},{label:"è²¡é‹",text:"è²¡æºå»£é€²ï¼Œæœ‰æœ›æ‹“å±•äº‹æ¥­ç‰ˆåœ–ã€‚"},{label:"é£²é£Ÿ",text:"é©åˆè¨­å®´æ¬¾å¾…ï¼ŒçœŸç å°èœæœ€åˆæ­¤å‰æ…¶æ°›åœã€‚"}]
  },
  { num:"ç¬¬äº”ç±¤", level:"ok", badge:"å¹³å®‰",
    poem:["å¹³å¹³å®‰å®‰æ˜¯æœ€çœŸ","æŸ´ç±³æ²¹é¹½æœ‰é¤˜å­˜","çŸ¥è¶³å¸¸æ¨‚å¿ƒè‡ªåœ¨","ä¸€ç²¥ä¸€é£¯çš†æ˜¯æ©"],
    sections:[{label:"ç¸½è«–",text:"å¹³å®‰ç„¡äº‹å³æ˜¯ç¦ï¼ŒçŸ¥è¶³å¸¸æ¨‚ï¼Œè¸å¯¦ç”Ÿæ´»ã€‚"},{label:"äº‹æ¥­",text:"ç¾æ³ç©©å®šï¼Œè¸å¯¦é€²æ­¥ã€‚"},{label:"æ„›æƒ…",text:"æ„Ÿæƒ…å¹³é †ï¼Œäº’ç›¸é«”è«’ï¼Œå¹³æ·¡è¦‹çœŸæƒ…ã€‚"},{label:"è²¡é‹",text:"æ”¶æ”¯å¹³è¡¡ï¼Œé‡å…¥ç‚ºå‡ºï¼Œå„²è“„ç‚ºä¸Šã€‚"},{label:"é£²é£Ÿ",text:"ç°¡å–®å®¶å¸¸å°èœæœ€èƒ½æº«æš–äººå¿ƒã€‚"}]
  }
];

var currentFortune=null, soundOn=true, shakeCount=0, lastAccel={x:0,y:0,z:0};
var shakeBlocked=false, tapCount=0, tapTimer=null, audioCtx=null;

window.addEventListener('load',function(){
  setTimeout(function(){ var p=document.getElementById('preloader'); p.style.opacity='0'; setTimeout(function(){ p.style.display='none'; },800); },1400);
  createPetals(); initGyro(); renderFortuneList();
  document.getElementById('soundBtn').addEventListener('click',function(){ soundOn=!soundOn; this.textContent=soundOn?'ğŸ”Š':'ğŸ”‡'; });
  var trig=document.getElementById('hiddenTrigger');
  trig.addEventListener('click',function(){ tapCount++; if(tapTimer)clearTimeout(tapTimer); tapTimer=setTimeout(function(){ tapCount=0; },700); if(tapCount>=3){ tapCount=0; openPanel(); } });
});

function createPetals(){
  var c=document.getElementById('pageCover'), s=['âœ¿','â€','âš˜','âœ¾','â'];
  for(var i=0;i<10;i++){
    var p=document.createElement('div'); p.className='petal'; p.textContent=s[i%s.length];
    p.style.left=(Math.random()*100)+'%'; p.style.fontSize=(Math.random()*10+8)+'px';
    p.style.color='rgba(74,140,127,'+(Math.random()*0.3+0.1)+')';
    p.style.animationDuration=(Math.random()*12+10)+'s'; p.style.animationDelay=(Math.random()*10)+'s';
    c.appendChild(p);
  }
}

// ===== é™€èºå„€ =====
function initGyro(){
  if(typeof DeviceOrientationEvent!=='undefined'&&typeof DeviceOrientationEvent.requestPermission==='function'){
    document.getElementById('permDialog').classList.add('show');
  } else if(window.DeviceMotionEvent){ window.addEventListener('devicemotion',handleMotion,false); }
  window.addEventListener('deviceorientation',handleOrientation,false);
}
function requestPerm(){
  document.getElementById('permDialog').classList.remove('show');
  DeviceMotionEvent.requestPermission().then(function(s){ if(s==='granted'){ window.addEventListener('devicemotion',handleMotion,false); window.addEventListener('deviceorientation',handleOrientation,false); } }).catch(function(){});
}
function handleMotion(e){
  if(!document.getElementById('pageGame').classList.contains('active')||shakeBlocked) return;
  var a=e.accelerationIncludingGravity; if(!a) return;
  var d=Math.abs(a.x-lastAccel.x)+Math.abs(a.y-lastAccel.y)+Math.abs(a.z-lastAccel.z);
  lastAccel={x:a.x,y:a.y,z:a.z};
  if(d>14){ shakeCount++; if(shakeCount>=2){ triggerShake(); shakeCount=0; shakeBlocked=true; } }
}
function handleOrientation(e){
  if(!document.getElementById('pageCover').classList.contains('active')) return;
  var gm=e.gamma||0,bt=e.beta||0,mx=(gm/90)*18,my=(bt/90)*12;
  document.getElementById('lCircle').style.transform='translate(-50%,-50%) translate3d('+(mx*0.1)+'px,'+(my*0.1)+'px,0)';
  document.getElementById('lFlower').style.transform='translate(-50%,-56%) translate3d('+(mx*0.5)+'px,'+(my*0.4)+'px,0)';
  document.getElementById('lBase').style.transform='translate3d('+(mx*0.3)+'px,0,0)';
  document.getElementById('lLeft').style.transform='translate3d('+(mx*0.4)+'px,'+(my*0.3)+'px,0)';
  document.getElementById('lRight').style.transform='translate3d('+(mx*0.4)+'px,'+(my*0.3)+'px,0)';
}

// ===== é é¢åˆ‡æ› =====
function transition(cb){ var o=document.getElementById('overlay'); o.classList.add('in'); setTimeout(function(){ cb(); o.classList.remove('in'); },320); }
function showPage(id){ document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); }); document.getElementById(id).classList.add('active'); }
function goToGame(){
  playChord([440,554,659],0.06);
  shakeBlocked=false; shakeCount=0;
  document.getElementById('shakeInstruction').classList.remove('hidden');
  document.getElementById('tapHint').style.display='block';
  document.getElementById('shakeCan').classList.remove('shaking');
  document.getElementById('sticks').style.opacity='0';
  transition(function(){ showPage('pageGame'); });
}
function goToCover(){ transition(function(){ showPage('pageCover'); }); }
function goToResult(){ renderResult(currentFortune); transition(function(){ showPage('pageResult'); }); }

// ===== æ–ç±¤ =====
function doShake(){ triggerShake(); }
function triggerShake(){
  var can=document.getElementById('shakeCan');
  if(can.classList.contains('shaking')) return;
  playWoodShake();
  document.getElementById('shakeInstruction').classList.add('hidden');
  can.classList.add('shaking');
  document.getElementById('sticks').style.opacity='1';
  currentFortune = fortunes[Math.floor(Math.random()*fortunes.length)];
  setTimeout(function(){
    can.classList.remove('shaking');
    document.getElementById('sticks').style.opacity='0';
    document.getElementById('tapHint').style.display='none';
    playBell();
    launchSticks(currentFortune, function(){ goToResult(); });
  },2050);
}

// ===== ç±¤ç«¹é£›å‡ºå‹•ç•« =====
function launchSticks(fortune, callback){
  var overlay=document.getElementById('stickOverlay');
  overlay.innerHTML=''; overlay.classList.add('active');
  var poem=fortune.poem;
  var cfg=[
    {left:'8%',  r0:'-22deg', y1:'-28vh', r1:'-14deg', y2:'-60vh', r2:'-8deg', y3:'-58vh', r3:'-7deg', dur:'1.15s', delay:'0s'},
    {left:'28%', r0:'-8deg',  y1:'-32vh', r1:'-3deg',  y2:'-66vh', r2:'-1deg', y3:'-64vh', r3:'-1deg', dur:'1.1s',  delay:'0.1s'},
    {left:'50%', r0:'4deg',   y1:'-34vh', r1:'1deg',   y2:'-68vh', r2:'1deg',  y3:'-66vh', r3:'1deg',  dur:'1.12s', delay:'0.18s'},
    {left:'68%', r0:'14deg',  y1:'-30vh', r1:'8deg',   y2:'-62vh', r2:'5deg',  y3:'-60vh', r3:'5deg',  dur:'1.08s', delay:'0.08s'},
  ];
  for(var i=0;i<4;i++){
    (function(idx){
      var c=cfg[idx];
      var el=document.createElement('div');
      el.className='flying-stick';
      el.textContent=poem[idx]||'';
      el.style.left=c.left;
      el.style.setProperty('--r0',c.r0); el.style.setProperty('--y1',c.y1); el.style.setProperty('--r1',c.r1);
      el.style.setProperty('--y2',c.y2); el.style.setProperty('--r2',c.r2); el.style.setProperty('--y3',c.y3);
      el.style.setProperty('--r3',c.r3); el.style.setProperty('--dur',c.dur); el.style.setProperty('--delay',c.delay);
      overlay.appendChild(el);
    })(i);
  }
  setTimeout(function(){ overlay.classList.remove('active'); overlay.innerHTML=''; if(callback)callback(); },1700);
}

// ===== æ¸²æŸ“çµæœ =====
function renderResult(f){
  document.getElementById('cardNum').textContent=f.num;
  var badge=document.getElementById('cardBadge'); badge.textContent=f.badge; badge.className='level-badge badge-'+f.level;
  var pe=document.getElementById('cardPoem'); pe.innerHTML='';
  f.poem.forEach(function(line,i){
    var p=document.createElement('p'); p.className='poem-line'; p.textContent=line;
    p.style.animationDelay=(i*0.18+0.08)+'s'; pe.appendChild(p);
  });
  var se=document.getElementById('cardSections'); se.innerHTML='';
  f.sections.forEach(function(s,i){
    var d=document.createElement('div'); d.className='card-section';
    d.innerHTML='<span class="section-tag">'+s.label+'</span><span class="section-body">'+s.text+'</span>';
    d.style.animationDelay=(i*0.1+0.45)+'s'; se.appendChild(d);
  });
}

// ===== éŸ³æ•ˆï¼ˆä¿®å¾©ç‰ˆ â€” AudioContext å»¶é²å‰µå»º + resumeï¼‰=====
function getCtx(){
  if(!audioCtx){ try{ audioCtx=new(window.AudioContext||window.webkitAudioContext)(); }catch(e){ return null; } }
  if(audioCtx.state==='suspended') audioCtx.resume();
  return audioCtx;
}
function playNote(freq,vol,dur,type,when){
  if(!soundOn) return;
  var ctx=getCtx(); if(!ctx) return;
  var t=when||ctx.currentTime;
  try{
    var o=ctx.createOscillator(),g=ctx.createGain();
    o.connect(g); g.connect(ctx.destination);
    o.frequency.value=freq; o.type=type||'sine';
    g.gain.setValueAtTime(0,t);
    g.gain.linearRampToValueAtTime(vol,t+0.018);
    g.gain.exponentialRampToValueAtTime(0.0001,t+dur);
    o.start(t); o.stop(t+dur+0.05);
  }catch(e){}
}
function playChord(freqs,vol){ freqs.forEach(function(f){ playNote(f,vol,0.85,'sine'); }); }
function playWoodShake(){
  var ctx=getCtx(); if(!ctx) return;
  [0,0.11,0.27,0.44,0.59,0.76,0.93,1.1,1.28,1.47,1.65,1.82].forEach(function(t){
    var f=180+Math.random()*160;
    playNote(f,0.09,0.07,'triangle',ctx.currentTime+t);
    playNote(f*1.6,0.045,0.055,'triangle',ctx.currentTime+t+0.014);
  });
}
function playBell(){
  var ctx=getCtx(); if(!ctx) return;
  [880,1108,1318,1760,2093].forEach(function(f,i){ playNote(f,0.07-i*0.01,1.4,'sine',ctx.currentTime+i*0.038); });
}

// ===== å®¢è£½åŒ– =====
function openPanel(){ document.getElementById('customPanel').classList.add('open'); }
function closePanel(){ document.getElementById('customPanel').classList.remove('open'); }
function applyAll(){
  document.getElementById('coverTitle').textContent=document.getElementById('cfg-title').value;
  document.getElementById('page-title').textContent=document.getElementById('cfg-title').value+' âœ¦ æ±‚å¥½é‹';
  document.getElementById('coverSubtitle').textContent=document.getElementById('cfg-subtitle').value;
  document.getElementById('btnEnterText').textContent=document.getElementById('cfg-btn').value;
  document.getElementById('gameTitle').textContent=document.getElementById('cfg-game-title').value;
  document.getElementById('shakeTipText').textContent=document.getElementById('cfg-shake-tip').value;
  document.getElementById('resultTitle').textContent=document.getElementById('cfg-result-title').value;
  var jade=document.getElementById('cfg-jade').value, jadeDeep=document.getElementById('cfg-jade-deep').value;
  var jadeLight=document.getElementById('cfg-jade-light').value, cream=document.getElementById('cfg-cream').value;
  document.documentElement.style.setProperty('--jade',jade);
  document.documentElement.style.setProperty('--jade-deep',jadeDeep);
  document.documentElement.style.setProperty('--jade-light',jadeLight);
  document.documentElement.style.setProperty('--jade-pale',hexRgba(jadeLight,0.38));
  document.documentElement.style.setProperty('--cream',cream);
  document.documentElement.style.setProperty('--warm-white',mixC(cream,'#ffffff',0.5));
  closePanel();
  var h=document.createElement('div');
  h.style.cssText='position:fixed;bottom:28px;left:50%;transform:translateX(-50%);background:'+jade+';color:#fff;padding:9px 22px;border-radius:30px;font-size:0.82rem;letter-spacing:0.2em;z-index:9999;font-family:sans-serif;';
  h.textContent='è¨­å®šå·²å¥—ç”¨ âœ“'; document.body.appendChild(h);
  setTimeout(function(){ h.style.transition='opacity 0.5s'; h.style.opacity='0'; setTimeout(function(){ h.remove(); },500); },1600);
}
function hexRgba(hex,a){ var r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16); return 'rgba('+r+','+g+','+b+','+a+')'; }
function mixC(h1,h2,r){ var p=function(h,i){ return parseInt(h.slice(i,i+2),16); }; var R=Math.round(p(h1,1)+(p(h2,1)-p(h1,1))*r),G=Math.round(p(h1,3)+(p(h2,3)-p(h1,3))*r),B=Math.round(p(h1,5)+(p(h2,5)-p(h1,5))*r); return '#'+[R,G,B].map(function(v){ return Math.max(0,Math.min(255,v)).toString(16).padStart(2,'0'); }).join(''); }
function renderFortuneList(){
  var list=document.getElementById('fortuneList'); list.innerHTML='';
  fortunes.forEach(function(f,i){
    var d=document.createElement('div'); d.className='fortune-item';
    d.innerHTML='<div class="fortune-item-head"><span>'+f.num+' Â· '+f.badge+'</span><button onclick="removeFortune('+i+')">âœ•</button></div>'+
      '<div class="cfg-row"><label>ç±¤å</label><input type="text" value="'+f.num+'" onchange="fortunes['+i+'].num=this.value"></div>'+
      '<div class="cfg-row"><label>ç‰ŒåŒ¾</label><input type="text" value="'+f.badge+'" onchange="fortunes['+i+'].badge=this.value"></div>'+
      '<div class="cfg-row"><label>ç­‰ç´š</label><select onchange="fortunes['+i+'].level=this.value">'+['great','good','ok','bad'].map(function(l){ return '<option value="'+l+'"'+(f.level==l?' selected':'')+'>'+l+'</option>'; }).join('')+'</select></div>'+
      '<div class="cfg-row"><label>ç±¤è©©ï¼ˆæ¯è¡Œä¸€å¥ï¼‰</label><textarea onchange="fortunes['+i+'].poem=this.value.split(\'\\n\').slice(0,4)">'+f.poem.join('\n')+'</textarea></div>';
    list.appendChild(d);
  });
}
function addFortune(){ fortunes.push({num:'ç¬¬'+(fortunes.length+1)+'ç±¤',level:'good',badge:'å‰',poem:['ç¬¬ä¸€å¥ç±¤è©©','ç¬¬äºŒå¥ç±¤è©©','ç¬¬ä¸‰å¥ç±¤è©©','ç¬¬å››å¥ç±¤è©©'],sections:[{label:'ç¸½è«–',text:'åœ¨æ­¤è¼¸å…¥è§£èªªæ–‡å­—ã€‚'},{label:'äº‹æ¥­',text:'åœ¨æ­¤è¼¸å…¥äº‹æ¥­é‹å‹¢ã€‚'}]}); renderFortuneList(); }
function removeFortune(i){ if(fortunes.length<=1){ alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€æ”¯ç±¤ï¼'); return; } fortunes.splice(i,1); renderFortuneList(); }
function exportCfg(){ var a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([JSON.stringify({fortunes:fortunes},null,2)],{type:'application/json'})); a.download='jinzhu-fortune-config.json'; a.click(); }
function saveImg(){ alert('è«‹é•·æŒ‰ç•«é¢æˆªåœ–å„²å­˜æ‚¨çš„ç±¤è©©çµæœã€‚'); }
</script>
</body>
</html>
